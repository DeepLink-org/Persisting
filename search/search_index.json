{"config":{"lang":["en","zh"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Persisting - Persistent Storage for AI Systems","text":""},{"location":"#persisting","title":"Persisting","text":"<p>Persisting is a persistent storage solution for AI systems, providing efficient storage for Parameters, KV Cache, and Trajectories.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Pluggable Backends - Support for multiple storage backends including Memory, Lance, and custom implementations.</li> <li>Lance Integration - Built on Lance columnar format for high-performance random access and zero-copy versioning.</li> <li>Write-Ahead Log - Built-in WAL support ensures data durability and crash recovery.</li> <li>Pulsing Integration - Seamless integration with Pulsing Actor framework for distributed queue persistence.</li> <li>Schema Evolution - Support for dynamic schema evolution without downtime.</li> <li>Monitoring Metrics - Built-in Prometheus metrics export for real-time monitoring.</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Install\npip install persisting\n\n# Or install with Pulsing\npip install persisting[pulsing]\n</code></pre> <pre><code>import pulsing as pul\nimport persisting as pst\n\n# Register Lance backend\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n# Use persistent queue\nwriter = await pul.queue.write_queue(system, \"my_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\")\n\nawait writer.put({\"id\": \"1\", \"value\": 42})\nawait writer.flush()\n</code></pre>"},{"location":"#use-cases","title":"Use Cases","text":"<ul> <li>KV Cache Storage - Store and retrieve LLM KV Cache for cross-session reuse.</li> <li>Trajectory Storage - Persistent storage for RL and training trajectories.</li> <li>Parameter Checkpoints - Efficient model parameter checkpoint storage with versioning.</li> </ul>"},{"location":"#community","title":"Community","text":"<ul> <li>GitHub Repository</li> <li>Issue Tracker</li> <li>Discussions</li> </ul>"},{"location":"api_reference/","title":"API Reference","text":"<p>This document provides a detailed API reference for Persisting.</p>"},{"location":"api_reference/#persistingqueue","title":"persisting.queue","text":""},{"location":"api_reference/#lancebackend","title":"LanceBackend","text":"<p>High-performance storage backend using Lance columnar format.</p> <pre><code>class LanceBackend:\n    \"\"\"Lance-based storage backend for Pulsing queues.\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        flush_threshold: int = 1000,\n        **kwargs,\n    ) -&gt; None:\n        \"\"\"\n        Initialize Lance backend.\n\n        Parameters\n        ----------\n        bucket_id : int\n            Unique identifier for this bucket.\n        storage_path : str\n            Path to store Lance dataset.\n        batch_size : int, optional\n            Batch size for operations (default: 100).\n        flush_threshold : int, optional\n            Number of records before auto-flush (default: 1000).\n        **kwargs\n            Additional options (ignored).\n        \"\"\"\n</code></pre>"},{"location":"api_reference/#methods","title":"Methods","text":""},{"location":"api_reference/#put","title":"put","text":"<pre><code>async def put(self, record: dict[str, Any]) -&gt; None:\n    \"\"\"\n    Store a single record.\n\n    Parameters\n    ----------\n    record : dict[str, Any]\n        Record to store.\n    \"\"\"\n</code></pre>"},{"location":"api_reference/#put_batch","title":"put_batch","text":"<pre><code>async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n    \"\"\"\n    Store multiple records efficiently.\n\n    Parameters\n    ----------\n    records : list[dict[str, Any]]\n        Records to store.\n    \"\"\"\n</code></pre>"},{"location":"api_reference/#get","title":"get","text":"<pre><code>async def get(\n    self,\n    offset: int = 0,\n    limit: int | None = None,\n) -&gt; list[dict[str, Any]]:\n    \"\"\"\n    Retrieve records from storage.\n\n    Parameters\n    ----------\n    offset : int, optional\n        Starting offset (default: 0).\n    limit : int | None, optional\n        Maximum records to return (default: None = all).\n\n    Returns\n    -------\n    list[dict[str, Any]]\n        Retrieved records.\n    \"\"\"\n</code></pre>"},{"location":"api_reference/#get_stream","title":"get_stream","text":"<pre><code>async def get_stream(\n    self,\n    offset: int = 0,\n    limit: int | None = None,\n    block: bool = False,\n) -&gt; AsyncIterator[dict[str, Any]]:\n    \"\"\"\n    Stream records from storage.\n\n    Parameters\n    ----------\n    offset : int, optional\n        Starting offset (default: 0).\n    limit : int | None, optional\n        Maximum records to return (default: None = unlimited).\n    block : bool, optional\n        If True, wait for new records when caught up (default: False).\n\n    Yields\n    ------\n    dict[str, Any]\n        Records from storage.\n    \"\"\"\n</code></pre>"},{"location":"api_reference/#flush","title":"flush","text":"<pre><code>async def flush(self) -&gt; None:\n    \"\"\"\n    Persist buffered data to Lance storage.\n\n    Writes all buffered records to the Lance dataset and\n    clears the buffer.\n    \"\"\"\n</code></pre>"},{"location":"api_reference/#stats","title":"stats","text":"<pre><code>async def stats(self) -&gt; dict[str, Any]:\n    \"\"\"\n    Get storage statistics.\n\n    Returns\n    -------\n    dict[str, Any]\n        Statistics including:\n        - bucket_id: Bucket identifier\n        - total_count: Total record count\n        - buffer_count: Records in buffer\n        - persisted_count: Records in Lance\n        - storage_path: Path to Lance dataset\n    \"\"\"\n</code></pre>"},{"location":"api_reference/#total_count","title":"total_count","text":"<pre><code>def total_count(self) -&gt; int:\n    \"\"\"\n    Get total record count.\n\n    Returns\n    -------\n    int\n        Total number of records (buffer + persisted).\n    \"\"\"\n</code></pre>"},{"location":"api_reference/#persistingbackend","title":"PersistingBackend","text":"<p>Enhanced storage backend with WAL, compression, and metrics.</p> <pre><code>class PersistingBackend:\n    \"\"\"Enhanced storage backend with enterprise features.\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        enable_wal: bool = False,\n        compression: str | None = None,\n        enable_metrics: bool = False,\n        wal_sync_interval: float = 1.0,\n        max_wal_size: int = 100 * 1024 * 1024,\n        **kwargs,\n    ) -&gt; None:\n        \"\"\"\n        Initialize Persisting backend.\n\n        Parameters\n        ----------\n        bucket_id : int\n            Unique identifier for this bucket.\n        storage_path : str\n            Path to store data.\n        batch_size : int, optional\n            Batch size for operations (default: 100).\n        enable_wal : bool, optional\n            Enable Write-Ahead Log (default: False).\n        compression : str | None, optional\n            Compression algorithm: \"zstd\", \"lz4\", \"snappy\" (default: None).\n        enable_metrics : bool, optional\n            Enable Prometheus metrics (default: False).\n        wal_sync_interval : float, optional\n            WAL sync interval in seconds (default: 1.0).\n        max_wal_size : int, optional\n            Maximum WAL file size in bytes (default: 100MB).\n        **kwargs\n            Additional options (ignored).\n        \"\"\"\n</code></pre>"},{"location":"api_reference/#methods_1","title":"Methods","text":"<p>Inherits all methods from <code>LanceBackend</code> with enhanced behavior:</p> <ul> <li><code>put()</code> - Writes to WAL first if enabled</li> <li><code>flush()</code> - Truncates WAL after successful flush</li> <li><code>stats()</code> - Includes WAL and compression info</li> </ul>"},{"location":"api_reference/#usage-examples","title":"Usage Examples","text":""},{"location":"api_reference/#basic-usage","title":"Basic Usage","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# Register backend\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n# Create writer\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"example\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n)\n\n# Write data\nawait writer.put({\"id\": \"1\", \"value\": 42})\nawait writer.flush()\n\n# Read data\nreader = await pul.queue.read_queue(system, \"example\")\nrecords = await reader.get(limit=10)\n</code></pre>"},{"location":"api_reference/#with-wal","title":"With WAL","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"durable\",\n    backend=\"persisting\",\n    backend_options={\n        \"enable_wal\": True,\n        \"wal_sync_interval\": 0.1,\n    },\n)\n</code></pre>"},{"location":"api_reference/#streaming","title":"Streaming","text":"<pre><code>import pulsing as pul\n\nreader = await pul.queue.read_queue(system, \"example\")\n\n# Non-blocking stream\nasync for record in reader.get_stream(limit=100):\n    process(record)\n\n# Blocking stream (waits for new data)\nasync for record in reader.get_stream(block=True):\n    process(record)\n</code></pre>"},{"location":"api_reference/#exceptions","title":"Exceptions","text":""},{"location":"api_reference/#storageerror","title":"StorageError","text":"<p>Base exception for storage operations.</p> <pre><code>class StorageError(Exception):\n    \"\"\"Base exception for storage operations.\"\"\"\n    pass\n</code></pre>"},{"location":"api_reference/#walerror","title":"WALError","text":"<p>Exception for WAL-related errors.</p> <pre><code>class WALError(StorageError):\n    \"\"\"Exception for WAL operations.\"\"\"\n    pass\n</code></pre>"},{"location":"api_reference/#type-definitions","title":"Type Definitions","text":""},{"location":"api_reference/#storagebackend-protocol","title":"StorageBackend Protocol","text":"<pre><code>from typing import Protocol, AsyncIterator, Any\n\nclass StorageBackend(Protocol):\n    \"\"\"Protocol for pluggable storage backends.\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None: ...\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None: ...\n    async def get(self, offset: int = 0, limit: int | None = None) -&gt; list[dict[str, Any]]: ...\n    async def get_stream(\n        self, offset: int = 0, limit: int | None = None, block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]: ...\n    async def flush(self) -&gt; None: ...\n    async def stats(self) -&gt; dict[str, Any]: ...\n    def total_count(self) -&gt; int: ...\n</code></pre>"},{"location":"installation/","title":"Installation","text":"<p>This guide covers the installation of Persisting.</p>"},{"location":"installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10 or higher</li> <li>pip or uv package manager</li> </ul>"},{"location":"installation/#installation-methods","title":"Installation Methods","text":""},{"location":"installation/#using-pip","title":"Using pip","text":"<pre><code># Basic installation\npip install persisting\n\n# With Pulsing integration\npip install persisting[pulsing]\n\n# With all optional dependencies\npip install persisting[all]\n</code></pre>"},{"location":"installation/#using-uv","title":"Using uv","text":"<pre><code># Basic installation\nuv pip install persisting\n\n# With Pulsing integration\nuv pip install persisting[pulsing]\n</code></pre>"},{"location":"installation/#from-source","title":"From Source","text":"<pre><code># Clone the repository\ngit clone https://github.com/reiase/Persisting.git\ncd Persisting\n\n# Install in development mode\npip install -e .\n\n# Or with uv\nuv pip install -e .\n</code></pre>"},{"location":"installation/#dependencies","title":"Dependencies","text":"<p>Persisting has the following dependencies:</p> Package Version Description <code>lance</code> &gt;=0.9.0 Lance columnar data format <code>pyarrow</code> &gt;=14.0.0 Apache Arrow for data interchange <code>pulsing</code> &gt;=0.1.0 (Optional) Pulsing Actor framework"},{"location":"installation/#verification","title":"Verification","text":"<p>Verify your installation:</p> <pre><code>import persisting\nprint(persisting.__version__)\n\n# Check available backends\nfrom persisting.queue import LanceBackend, PersistingBackend\nprint(\"LanceBackend available:\", LanceBackend is not None)\nprint(\"PersistingBackend available:\", PersistingBackend is not None)\n</code></pre>"},{"location":"installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start - Get started with Persisting</li> <li>User Guide - Learn about storage backends</li> <li>API Reference - Detailed API documentation</li> </ul>"},{"location":"quickstart/","title":"Quick Start","text":"<p>This guide will help you get started with Persisting in minutes.</p>"},{"location":"quickstart/#basic-usage","title":"Basic Usage","text":""},{"location":"quickstart/#step-1-install-persisting","title":"Step 1: Install Persisting","text":"<pre><code>pip install persisting[pulsing]\n</code></pre>"},{"location":"quickstart/#step-2-register-backend-with-pulsing","title":"Step 2: Register Backend with Pulsing","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# Register the Lance backend\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n</code></pre>"},{"location":"quickstart/#step-3-create-a-persistent-queue","title":"Step 3: Create a Persistent Queue","text":"<pre><code>import asyncio\nimport pulsing as pul\nimport persisting as pst\n\nasync def main():\n    # Register backend\n    pul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n    # Create actor system\n    system = await pul.actor.create_actor_system(pul.actor.SystemConfig.standalone())\n\n    # Create queue writer with Lance persistence\n    writer = await pul.queue.write_queue(\n        system,\n        topic=\"my_data\",\n        backend=\"lance\",\n        storage_path=\"/data/queues\",\n        num_buckets=4,\n        batch_size=100,\n    )\n\n    # Write data\n    for i in range(10):\n        await writer.put({\"id\": str(i), \"value\": i * 10})\n\n    # Flush to persist\n    await writer.flush()\n\n    # Create queue reader\n    reader = await pul.queue.read_queue(system, \"my_data\")\n\n    # Read data\n    async for record in reader.get_stream():\n        print(f\"Read: {record}\")\n\n    await system.shutdown()\n\nasyncio.run(main())\n</code></pre>"},{"location":"quickstart/#using-different-backends","title":"Using Different Backends","text":""},{"location":"quickstart/#memory-backend-for-testing","title":"Memory Backend (for testing)","text":"<pre><code>import pulsing as pul\n\n# Memory backend is built into Pulsing (no persistence)\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"test_topic\",\n    backend=\"memory\",\n)\n</code></pre>"},{"location":"quickstart/#lance-backend-recommended-for-production","title":"Lance Backend (recommended for production)","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"prod_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n)\n</code></pre>"},{"location":"quickstart/#persisting-backend-enhanced-features","title":"Persisting Backend (enhanced features)","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"advanced_topic\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n    },\n)\n</code></pre>"},{"location":"quickstart/#backend-options","title":"Backend Options","text":""},{"location":"quickstart/#lance-backend-options","title":"Lance Backend Options","text":"Option Type Default Description <code>flush_threshold</code> int 1000 Records before auto-flush"},{"location":"quickstart/#persisting-backend-options","title":"Persisting Backend Options","text":"Option Type Default Description <code>enable_wal</code> bool False Enable Write-Ahead Log <code>compression</code> str None Compression algorithm <code>enable_metrics</code> bool False Enable Prometheus metrics"},{"location":"quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>User Guide - Learn more about storage backends</li> <li>Lance Backend - Lance backend details</li> <li>Persisting Backend - Enhanced backend features</li> <li>API Reference - Detailed API documentation</li> </ul>"},{"location":"design/","title":"Design Documents","text":"<p>This section contains design documents describing Persisting's architecture and implementation details.</p>"},{"location":"design/#overview","title":"Overview","text":"<p>Persisting is designed as a modular persistent storage system that integrates with Pulsing's distributed queue infrastructure. Key design principles include:</p> <ul> <li>Pluggable Architecture - Storage backends can be swapped without changing application code</li> <li>Pulsing Integration - Seamless integration with Pulsing Actor framework</li> <li>Production Ready - Enterprise features like WAL, monitoring, and schema evolution</li> </ul>"},{"location":"design/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        Application Layer                        \u2502\n\u2502                                                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502    \u2502 QueueWriter \u2502     \u2502 QueueReader \u2502     \u2502   Queue     \u2502    \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502           \u2502                   \u2502                   \u2502            \u2502\n\u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                               \u2502                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Pulsing Layer                           \u2502\n\u2502                               \u2502                                 \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502              \u2502        StorageManager          \u2502                \u2502\n\u2502              \u2502    (Actor per node)            \u2502                \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                               \u2502                                 \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502         \u2502                     \u2502                     \u2502          \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502    \u2502 Bucket 0 \u2502         \u2502 Bucket 1 \u2502         \u2502 Bucket N \u2502     \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2502                    \u2502                    \u2502            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                    \u2502                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u2502              Backend Layer              \u2502            \u2502\n\u2502         \u2502                    \u2502                    \u2502            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502    \u2502 Backend  \u2502         \u2502 Backend  \u2502         \u2502 Backend  \u2502     \u2502\n\u2502    \u2502(Memory/  \u2502         \u2502(Lance/   \u2502         \u2502(Custom)  \u2502     \u2502\n\u2502    \u2502 Lance)   \u2502         \u2502Persisting\u2502         \u2502          \u2502     \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2502                    \u2502                    \u2502            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                    \u2502                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u2502             Storage Layer               \u2502            \u2502\n\u2502         \u25bc                    \u25bc                    \u25bc            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502    \u2502 Memory  \u2502          \u2502  Lance  \u2502          \u2502 Custom  \u2502      \u2502\n\u2502    \u2502         \u2502          \u2502  Files  \u2502          \u2502 Storage \u2502      \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502                                                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"design/#documents","title":"Documents","text":"<ul> <li>Architecture - Overall system architecture</li> <li>Write-Ahead Log - WAL design and implementation</li> </ul>"},{"location":"design/#design-principles","title":"Design Principles","text":""},{"location":"design/#1-separation-of-concerns","title":"1. Separation of Concerns","text":"<p>Each layer has clear responsibilities:</p> <ul> <li>Application Layer: High-level queue APIs</li> <li>Pulsing Layer: Distributed actor management</li> <li>Backend Layer: Storage abstraction</li> <li>Storage Layer: Actual data persistence</li> </ul>"},{"location":"design/#2-protocol-based-abstraction","title":"2. Protocol-Based Abstraction","text":"<p>The <code>StorageBackend</code> protocol defines a clear contract:</p> <pre><code>class StorageBackend(Protocol):\n    async def put(self, record: dict[str, Any]) -&gt; None: ...\n    async def get(self, offset: int, limit: int) -&gt; list[dict]: ...\n    async def flush(self) -&gt; None: ...\n    # ...\n</code></pre>"},{"location":"design/#3-composition-over-inheritance","title":"3. Composition over Inheritance","text":"<p>Backends are composed into <code>BucketStorage</code> actors rather than inheriting from a base class.</p>"},{"location":"design/#4-fail-safe-defaults","title":"4. Fail-Safe Defaults","text":"<ul> <li>Memory backend for testing (no external dependencies)</li> <li>Sensible default configurations</li> <li>Graceful degradation</li> </ul>"},{"location":"design/#future-work","title":"Future Work","text":"<ul> <li>[ ] Multi-region replication</li> <li>[ ] Tiered storage (hot/cold)</li> <li>[ ] Query optimization</li> <li>[ ] Backup and restore utilities</li> </ul>"},{"location":"design/architecture/","title":"Architecture","text":"<p>This document describes the overall architecture of Persisting.</p>"},{"location":"design/architecture/#system-components","title":"System Components","text":""},{"location":"design/architecture/#1-storagebackend-protocol","title":"1. StorageBackend Protocol","text":"<p>The core abstraction that all backends implement:</p> <pre><code>class StorageBackend(Protocol):\n    \"\"\"Storage backend protocol for pluggable persistence.\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"Store a single record.\"\"\"\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"Store multiple records efficiently.\"\"\"\n\n    async def get(self, offset: int, limit: int | None) -&gt; list[dict]:\n        \"\"\"Retrieve records from offset.\"\"\"\n\n    async def get_stream(\n        self, offset: int, limit: int | None, block: bool\n    ) -&gt; AsyncIterator[dict]:\n        \"\"\"Stream records, optionally blocking for new data.\"\"\"\n\n    async def flush(self) -&gt; None:\n        \"\"\"Persist buffered data to storage.\"\"\"\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"Return storage statistics.\"\"\"\n\n    def total_count(self) -&gt; int:\n        \"\"\"Return total record count.\"\"\"\n</code></pre>"},{"location":"design/architecture/#2-lancebackend","title":"2. LanceBackend","text":"<p>High-performance storage using Lance columnar format:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             LanceBackend                \u2502\n\u2502                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502         Memory Buffer           \u2502   \u2502\n\u2502  \u2502  (Records waiting for flush)    \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                 \u2502                       \u2502\n\u2502                 \u25bc flush()               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502        Lance Dataset            \u2502   \u2502\n\u2502  \u2502  (Columnar storage on disk)     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Features: - In-memory buffering for write coalescing - Automatic schema inference - Version control built-in - High-performance columnar storage</p>"},{"location":"design/architecture/#3-persistingbackend","title":"3. PersistingBackend","text":"<p>Enhanced backend with enterprise features:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   PersistingBackend                      \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                  WAL Layer                       \u2502   \u2502\n\u2502  \u2502  (Write-Ahead Log for durability)               \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                         \u2502                               \u2502\n\u2502                         \u25bc                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502               Memory Buffer                      \u2502   \u2502\n\u2502  \u2502  (With compression support)                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                         \u2502                               \u2502\n\u2502                         \u25bc flush()                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502              Lance Dataset                       \u2502   \u2502\n\u2502  \u2502  (With schema evolution support)                \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502            Metrics Collector                     \u2502   \u2502\n\u2502  \u2502  (Prometheus metrics export)                    \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Features: - All LanceBackend features - Write-Ahead Log for crash recovery - Schema evolution support - Compression options - Prometheus metrics</p>"},{"location":"design/architecture/#data-flow","title":"Data Flow","text":""},{"location":"design/architecture/#write-path","title":"Write Path","text":"<pre><code>Application\n    \u2502\n    \u25bc put(record)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  QueueWriter    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc route by bucket_column\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 StorageManager  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc send to bucket owner\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 BucketStorage   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc delegate to backend\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 StorageBackend  \u2502\u2500\u2500\u25ba WAL (if enabled)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc buffer\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Memory Buffer  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc flush() when threshold reached\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Lance Dataset  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"design/architecture/#read-path","title":"Read Path","text":"<pre><code>Application\n    \u2502\n    \u25bc get(offset, limit)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  QueueReader    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 StorageManager  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc query each bucket\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         BucketStorage (parallel)    \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502 B0  \u2502  \u2502 B1  \u2502  \u2502 BN  \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u252c\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2518       \u2502\n\u2502      \u2502        \u2502        \u2502           \u2502\n\u2502      \u25bc        \u25bc        \u25bc           \u2502\n\u2502   StorageBackend.get()             \u2502\n\u2502      \u2502        \u2502        \u2502           \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502               \u2502                     \u2502\n\u2502               \u25bc                     \u2502\n\u2502         Merge Results              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n    Application\n</code></pre>"},{"location":"design/architecture/#bucket-distribution","title":"Bucket Distribution","text":"<p>Records are distributed across buckets using consistent hashing:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Bucket Ring                           \u2502\n\u2502                                                          \u2502\n\u2502                       Node A                             \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2502 Bucket 0\u2502\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502              \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502                    \u2502\n\u2502              \u2502                     \u2502                    \u2502\n\u2502        \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   Node C\u2502Bucket 3\u2502           \u2502Bucket 1 \u2502Node B          \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502              \u2502                    \u2502                     \u2502\n\u2502              \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502                     \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2502 Bucket 2\u2502\u2500\u2500\u2500\u2500\u2518                     \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502\n\u2502                       Node B                             \u2502\n\u2502                                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nRecord routing:\n  hash(record[bucket_column]) % num_buckets \u2192 bucket_id\n  bucket_id \u2192 owner_node (via consistent hashing)\n</code></pre>"},{"location":"design/architecture/#concurrency-model","title":"Concurrency Model","text":""},{"location":"design/architecture/#thread-safety","title":"Thread Safety","text":"<p>All backends use <code>asyncio.Condition</code> for safe concurrent access:</p> <pre><code>class Backend:\n    def __init__(self):\n        self._condition = asyncio.Condition()\n\n    async def put(self, record):\n        async with self._condition:\n            self._buffer.append(record)\n            self._condition.notify_all()  # Wake readers\n\n    async def get_stream(self, block=False):\n        async with self._condition:\n            while no_data_available:\n                if not block:\n                    return\n                await self._condition.wait()  # Wait for data\n</code></pre>"},{"location":"design/architecture/#blocking-reads","title":"Blocking Reads","text":"<p>The <code>get_stream(block=True)</code> pattern enables consumer blocking:</p> <pre><code>async for record in reader.get_stream(block=True):\n    # Will wait for new records when caught up\n    process(record)\n</code></pre>"},{"location":"design/architecture/#configuration","title":"Configuration","text":""},{"location":"design/architecture/#backend-selection","title":"Backend Selection","text":"<pre><code># By name (must be registered)\nwriter = await write_queue(system, topic, backend=\"lance\")\n\n# By class (auto-registers)\nwriter = await write_queue(system, topic, backend=LanceBackend)\n</code></pre>"},{"location":"design/architecture/#backend-options","title":"Backend Options","text":"<p>Options are passed through to the backend constructor:</p> <pre><code>writer = await write_queue(\n    system, topic,\n    backend=\"persisting\",\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n    },\n)\n</code></pre>"},{"location":"design/architecture/#error-handling","title":"Error Handling","text":""},{"location":"design/architecture/#write-failures","title":"Write Failures","text":"<pre><code>try:\n    await writer.put(record)\nexcept StorageError as e:\n    # Handle storage failure\n    logger.error(f\"Write failed: {e}\")\n</code></pre>"},{"location":"design/architecture/#recovery","title":"Recovery","text":"<p>With WAL enabled, uncommitted data is recovered on startup:</p> <pre><code>Startup\n    \u2502\n    \u25bc\nCheck for WAL files\n    \u2502\n    \u251c\u2500\u25ba No WAL: Normal startup\n    \u2502\n    \u2514\u2500\u25ba WAL exists: Replay uncommitted records\n            \u2502\n            \u25bc\n        Apply to buffer\n            \u2502\n            \u25bc\n        Continue normal operation\n</code></pre>"},{"location":"design/architecture/#future-considerations","title":"Future Considerations","text":"<ol> <li>Multi-region replication - Cross-datacenter data sync</li> <li>Tiered storage - Hot/cold data management</li> <li>Query pushdown - Filter evaluation in storage layer</li> <li>Backup/restore - Point-in-time recovery</li> </ol>"},{"location":"design/wal/","title":"Write-Ahead Log (WAL)","text":"<p>This document describes the Write-Ahead Log design in Persisting.</p>"},{"location":"design/wal/#overview","title":"Overview","text":"<p>Write-Ahead Log (WAL) ensures data durability by recording changes before they are applied to the main storage. This allows recovery of uncommitted data after crashes.</p>"},{"location":"design/wal/#design-goals","title":"Design Goals","text":"<ol> <li>Durability - No data loss after acknowledged writes</li> <li>Performance - Minimal overhead for write operations</li> <li>Recovery - Fast and correct crash recovery</li> <li>Simplicity - Easy to understand and maintain</li> </ol>"},{"location":"design/wal/#architecture","title":"Architecture","text":"<pre><code>Write Request\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            WAL Writer                   \u2502\n\u2502                                         \u2502\n\u2502  1. Serialize record to bytes           \u2502\n\u2502  2. Write length + checksum + data      \u2502\n\u2502  3. fsync() (if sync mode)              \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            WAL File                     \u2502\n\u2502                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 Record 1: [len][crc][data]      \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 Record 2: [len][crc][data]      \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 Record 3: [len][crc][data]      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Memory Buffer                  \u2502\n\u2502                                         \u2502\n\u2502  (Records buffered for batch flush)     \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc flush()\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Lance Dataset                  \u2502\n\u2502                                         \u2502\n\u2502  (Durable columnar storage)             \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Truncate WAL                   \u2502\n\u2502                                         \u2502\n\u2502  (Remove committed records)             \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"design/wal/#record-format","title":"Record Format","text":"<p>Each WAL record has the following format:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Length    \u2502  Checksum  \u2502       Data         \u2502\n\u2502  (4 bytes) \u2502  (4 bytes) \u2502    (variable)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ul> <li>Length: Record data length (uint32, little-endian)</li> <li>Checksum: CRC32 of data (uint32, little-endian)</li> <li>Data: Serialized record (JSON or MessagePack)</li> </ul>"},{"location":"design/wal/#write-path","title":"Write Path","text":""},{"location":"design/wal/#normal-write","title":"Normal Write","text":"<pre><code>async def put(self, record: dict) -&gt; None:\n    if self.enable_wal:\n        # 1. Write to WAL first\n        await self._wal.append(record)\n\n    # 2. Add to memory buffer\n    async with self._condition:\n        self._buffer.append(record)\n        self._condition.notify_all()\n</code></pre>"},{"location":"design/wal/#sync-modes","title":"Sync Modes","text":"Mode Description Durability Performance <code>sync</code> fsync after each write Highest Slowest <code>batch</code> fsync periodically High Fast <code>async</code> OS-controlled sync Low Fastest <pre><code># Sync every write (safest)\nbackend_options={\"wal_sync_interval\": 0.0}\n\n# Sync every 100ms (balanced)\nbackend_options={\"wal_sync_interval\": 0.1}\n\n# OS-controlled (fastest)\nbackend_options={\"wal_sync_interval\": 1.0}\n</code></pre>"},{"location":"design/wal/#recovery","title":"Recovery","text":""},{"location":"design/wal/#startup-recovery","title":"Startup Recovery","text":"<pre><code>async def _recover(self) -&gt; None:\n    \"\"\"Recover uncommitted records from WAL.\"\"\"\n    if not self._wal_path.exists():\n        return\n\n    recovered = []\n    async for record in self._wal.read_all():\n        recovered.append(record)\n\n    if recovered:\n        logger.info(f\"Recovered {len(recovered)} records from WAL\")\n        self._buffer.extend(recovered)\n</code></pre>"},{"location":"design/wal/#recovery-flow","title":"Recovery Flow","text":"<pre><code>Startup\n    \u2502\n    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Check WAL exists               \u2502\n\u2502                                         \u2502\n\u2502  WAL path: {storage_path}/wal/          \u2502\n\u2502  WAL file: {bucket_id}.wal              \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                 \u2502\n   WAL exists        No WAL\n        \u2502                 \u2502\n        \u25bc                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Read records  \u2502  \u2502 Normal start  \u2502\n\u2502 Validate CRC  \u2502  \u2502               \u2502\n\u2502 Add to buffer \u2502  \u2502               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502\n        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Continue with \u2502\n\u2502 recovery data \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"design/wal/#corruption-handling","title":"Corruption Handling","text":"<pre><code>async def _read_record(self, file) -&gt; dict | None:\n    \"\"\"Read and validate a single record.\"\"\"\n    try:\n        # Read length\n        length_bytes = await file.read(4)\n        if len(length_bytes) &lt; 4:\n            return None\n        length = struct.unpack('&lt;I', length_bytes)[0]\n\n        # Read checksum\n        checksum_bytes = await file.read(4)\n        checksum = struct.unpack('&lt;I', checksum_bytes)[0]\n\n        # Read data\n        data = await file.read(length)\n\n        # Validate checksum\n        if crc32(data) != checksum:\n            logger.warning(\"WAL record corruption detected\")\n            return None\n\n        return json.loads(data)\n    except Exception as e:\n        logger.error(f\"WAL read error: {e}\")\n        return None\n</code></pre>"},{"location":"design/wal/#truncation","title":"Truncation","text":"<p>WAL is truncated after successful flush:</p> <pre><code>async def flush(self) -&gt; None:\n    \"\"\"Flush buffer to Lance and truncate WAL.\"\"\"\n    async with self._condition:\n        if not self._buffer:\n            return\n\n        # 1. Write to Lance\n        await self._write_to_lance(self._buffer)\n\n        # 2. Truncate WAL (records are now durable)\n        if self.enable_wal:\n            await self._wal.truncate()\n\n        # 3. Clear buffer\n        self._buffer.clear()\n</code></pre>"},{"location":"design/wal/#file-management","title":"File Management","text":""},{"location":"design/wal/#wal-directory-structure","title":"WAL Directory Structure","text":"<pre><code>{storage_path}/\n\u2514\u2500\u2500 {topic}/\n    \u2514\u2500\u2500 bucket_{id}/\n        \u251c\u2500\u2500 data.lance/          # Lance dataset\n        \u2514\u2500\u2500 wal/\n            \u251c\u2500\u2500 0.wal           # Current WAL file\n            \u2514\u2500\u2500 0.wal.tmp       # Temp file during rotation\n</code></pre>"},{"location":"design/wal/#wal-rotation","title":"WAL Rotation","text":"<p>When WAL exceeds <code>max_wal_size</code>:</p> <pre><code>async def _maybe_rotate(self) -&gt; None:\n    \"\"\"Rotate WAL if it exceeds max size.\"\"\"\n    if self._wal_size &gt; self.max_wal_size:\n        # 1. Force flush to Lance\n        await self.flush()\n\n        # 2. Create new WAL file\n        await self._wal.rotate()\n\n        self._wal_size = 0\n</code></pre>"},{"location":"design/wal/#configuration","title":"Configuration","text":"Option Type Default Description <code>enable_wal</code> bool False Enable WAL <code>wal_sync_interval</code> float 1.0 Sync interval (0=every write) <code>max_wal_size</code> int 100MB Max WAL size before rotation"},{"location":"design/wal/#performance-considerations","title":"Performance Considerations","text":""},{"location":"design/wal/#write-amplification","title":"Write Amplification","text":"<p>Each write goes to both WAL and buffer: - WAL: Sequential append (fast) - Buffer: In-memory (fast) - Lance: Batch write on flush (efficient)</p>"},{"location":"design/wal/#sync-trade-offs","title":"Sync Trade-offs","text":"<pre><code>                    Durability\n                        \u25b2\n                        \u2502\n        sync mode \u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                        \u2502\n       batch mode \u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                        \u2502\n        async mode \u2500\u2500\u2500\u2500\u2500\u2524\n                        \u2502\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Performance\n</code></pre>"},{"location":"design/wal/#best-practices","title":"Best Practices","text":"<ol> <li>Use batch sync for production: Balance durability and performance</li> <li>Size WAL appropriately: Too small = frequent rotation, too large = slow recovery</li> <li>Monitor WAL size: Alert on unexpected growth</li> <li>Test recovery: Regularly validate recovery works</li> </ol>"},{"location":"design/wal/#limitations","title":"Limitations","text":"<ol> <li>Single-writer assumption: WAL assumes one writer per bucket</li> <li>In-order recovery: Records are recovered in write order</li> <li>No partial record recovery: Corrupted records are skipped</li> </ol>"},{"location":"design/wal/#future-improvements","title":"Future Improvements","text":"<ol> <li>Compression: Compress WAL records</li> <li>Async I/O: Use io_uring on Linux</li> <li>Group commit: Batch sync across multiple writes</li> <li>Checksummed chunks: Handle partial writes better</li> </ol>"},{"location":"guide/","title":"User Guide","text":"<p>Welcome to the Persisting User Guide. This guide covers the core concepts and usage patterns.</p>"},{"location":"guide/#overview","title":"Overview","text":"<p>Persisting provides persistent storage backends for Pulsing's distributed queue system. It enables reliable data storage with features like:</p> <ul> <li>Lance-based persistence - High-performance columnar storage</li> <li>Write-Ahead Log (WAL) - Data durability guarantees</li> <li>Schema evolution - Flexible data structure changes</li> <li>Monitoring - Built-in metrics and observability</li> </ul>"},{"location":"guide/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Pulsing Queue                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 QueueWriter \u2502  \u2502 QueueReader \u2502  \u2502   Queue     \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2502                \u2502                \u2502             \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n\u2502                          \u25bc                              \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502              \u2502   StorageManager      \u2502                  \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                          \u25bc                              \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502              \u2502   BucketStorage       \u2502                  \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                          \u2502                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  StorageBackend Protocol                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502MemoryBackend\u2502  \u2502 LanceBackend\u2502  \u2502PersistingBackend\u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502       (Pulsing)        (Persisting)     (Persisting)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"guide/#core-concepts","title":"Core Concepts","text":""},{"location":"guide/#storage-backends","title":"Storage Backends","text":"<p>Storage backends implement the <code>StorageBackend</code> protocol and provide different storage strategies:</p> Backend Location Persistence Use Case <code>MemoryBackend</code> Pulsing No Testing, temporary data <code>LanceBackend</code> Persisting Yes Production workloads <code>PersistingBackend</code> Persisting Yes Advanced features (WAL, metrics)"},{"location":"guide/#backend-registration","title":"Backend Registration","text":"<p>Backends must be registered before use:</p> <pre><code>from pulsing.queue import register_backend\nfrom persisting.queue import LanceBackend\n\nregister_backend(\"lance\", LanceBackend)\n</code></pre>"},{"location":"guide/#backend-selection","title":"Backend Selection","text":"<p>Specify the backend when creating a queue:</p> <pre><code>from pulsing.queue import write_queue\n\n# By name (must be registered)\nwriter = await write_queue(system, \"topic\", backend=\"lance\")\n\n# By class directly\nwriter = await write_queue(system, \"topic\", backend=LanceBackend)\n</code></pre>"},{"location":"guide/#topics-in-this-guide","title":"Topics in This Guide","text":"<ul> <li>Queue Backends - Overview of storage backends</li> <li>Lance Backend - Using Lance for persistence</li> <li>Persisting Backend - Enhanced backend with WAL</li> <li>Custom Backends - Implementing custom backends</li> </ul>"},{"location":"guide/#next-steps","title":"Next Steps","text":"<p>Choose the topic that best matches your needs, or continue with the Queue Backends overview.</p>"},{"location":"guide/backends/","title":"Queue Backends","text":"<p>This guide provides an overview of the storage backends available in Persisting.</p>"},{"location":"guide/backends/#backend-protocol","title":"Backend Protocol","text":"<p>All backends implement the <code>StorageBackend</code> protocol:</p> <pre><code>from typing import Protocol, AsyncIterator, Any\n\nclass StorageBackend(Protocol):\n    \"\"\"Protocol for pluggable storage backends.\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"Store a single record.\"\"\"\n        ...\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"Store multiple records.\"\"\"\n        ...\n\n    async def get(self, offset: int = 0, limit: int | None = None) -&gt; list[dict[str, Any]]:\n        \"\"\"Retrieve records.\"\"\"\n        ...\n\n    async def get_stream(\n        self,\n        offset: int = 0,\n        limit: int | None = None,\n        block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]:\n        \"\"\"Stream records.\"\"\"\n        ...\n\n    async def flush(self) -&gt; None:\n        \"\"\"Persist buffered data.\"\"\"\n        ...\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"Get storage statistics.\"\"\"\n        ...\n\n    def total_count(self) -&gt; int:\n        \"\"\"Get total record count.\"\"\"\n        ...\n</code></pre>"},{"location":"guide/backends/#available-backends","title":"Available Backends","text":""},{"location":"guide/backends/#memorybackend-pulsing","title":"MemoryBackend (Pulsing)","text":"<p>Simple in-memory storage without persistence:</p> <pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(system, \"topic\", backend=\"memory\")\n</code></pre> <p>Characteristics:</p> <ul> <li>\u2705 Fast read/write</li> <li>\u2705 No dependencies</li> <li>\u274c No persistence</li> <li>\u274c Data lost on restart</li> </ul> <p>Use cases: Testing, development, temporary data</p>"},{"location":"guide/backends/#lancebackend-persisting","title":"LanceBackend (Persisting)","text":"<p>Lance-based persistent storage:</p> <pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\nwriter = await pul.queue.write_queue(system, \"topic\", backend=\"lance\", storage_path=\"/data\")\n</code></pre> <p>Characteristics:</p> <ul> <li>\u2705 High-performance columnar storage</li> <li>\u2705 Data persistence</li> <li>\u2705 Version control</li> <li>\u2705 Vector search support</li> </ul> <p>Use cases: Production workloads, ML data storage</p>"},{"location":"guide/backends/#persistingbackend-persisting","title":"PersistingBackend (Persisting)","text":"<p>Enhanced backend with advanced features:</p> <pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    storage_path=\"/data\",\n    backend_options={\"enable_wal\": True}\n)\n</code></pre> <p>Characteristics:</p> <ul> <li>\u2705 All Lance features</li> <li>\u2705 Write-Ahead Log (WAL)</li> <li>\u2705 Schema evolution</li> <li>\u2705 Prometheus metrics</li> </ul> <p>Use cases: Production with durability requirements</p>"},{"location":"guide/backends/#backend-comparison","title":"Backend Comparison","text":"Feature Memory Lance Persisting Persistence \u274c \u2705 \u2705 WAL \u274c \u274c \u2705 Compression \u274c \u2705 \u2705 Metrics \u274c \u274c \u2705 Schema Evolution N/A \u274c \u2705 Vector Search \u274c \u2705 \u2705"},{"location":"guide/backends/#backend-registration","title":"Backend Registration","text":"<p>Register custom backends with Pulsing:</p> <pre><code>import pulsing as pul\n\n# Register a backend\npul.queue.register_backend(\"my_backend\", MyBackendClass)\n\n# Get a registered backend\nbackend_class = pul.queue.get_backend_class(\"my_backend\")\n\n# List all backends\navailable = pul.queue.list_backends()\nprint(available)  # ['memory', 'my_backend', ...]\n</code></pre>"},{"location":"guide/backends/#next-steps","title":"Next Steps","text":"<ul> <li>Lance Backend - Detailed Lance backend guide</li> <li>Persisting Backend - Enhanced backend features</li> <li>Custom Backends - Implement your own backend</li> </ul>"},{"location":"guide/custom/","title":"Custom Backends","text":"<p>This guide shows how to implement custom storage backends for Pulsing queues.</p>"},{"location":"guide/custom/#storagebackend-protocol","title":"StorageBackend Protocol","text":"<p>All backends must implement the <code>StorageBackend</code> protocol:</p> <pre><code>from typing import Protocol, AsyncIterator, Any\n\nclass StorageBackend(Protocol):\n    \"\"\"Protocol for pluggable storage backends.\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"Store a single record.\"\"\"\n        ...\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"Store multiple records efficiently.\"\"\"\n        ...\n\n    async def get(\n        self,\n        offset: int = 0,\n        limit: int | None = None\n    ) -&gt; list[dict[str, Any]]:\n        \"\"\"Retrieve records from storage.\"\"\"\n        ...\n\n    async def get_stream(\n        self,\n        offset: int = 0,\n        limit: int | None = None,\n        block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]:\n        \"\"\"Stream records from storage.\"\"\"\n        ...\n\n    async def flush(self) -&gt; None:\n        \"\"\"Persist any buffered data.\"\"\"\n        ...\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"Return storage statistics.\"\"\"\n        ...\n\n    def total_count(self) -&gt; int:\n        \"\"\"Return total record count.\"\"\"\n        ...\n</code></pre>"},{"location":"guide/custom/#basic-implementation","title":"Basic Implementation","text":"<p>Here's a minimal backend implementation:</p> <pre><code>import asyncio\nfrom typing import Any, AsyncIterator\n\nclass SimpleBackend:\n    \"\"\"A simple in-memory backend.\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        **kwargs,\n    ):\n        self.bucket_id = bucket_id\n        self.storage_path = storage_path\n        self.batch_size = batch_size\n        self._records: list[dict[str, Any]] = []\n        self._condition = asyncio.Condition()\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"Store a single record.\"\"\"\n        async with self._condition:\n            self._records.append(record)\n            self._condition.notify_all()\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"Store multiple records.\"\"\"\n        async with self._condition:\n            self._records.extend(records)\n            self._condition.notify_all()\n\n    async def get(\n        self,\n        offset: int = 0,\n        limit: int | None = None\n    ) -&gt; list[dict[str, Any]]:\n        \"\"\"Retrieve records.\"\"\"\n        if limit is None:\n            return self._records[offset:]\n        return self._records[offset:offset + limit]\n\n    async def get_stream(\n        self,\n        offset: int = 0,\n        limit: int | None = None,\n        block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]:\n        \"\"\"Stream records.\"\"\"\n        current = offset\n        count = 0\n\n        while True:\n            async with self._condition:\n                while current &gt;= len(self._records):\n                    if not block:\n                        return\n                    await self._condition.wait()\n\n                while current &lt; len(self._records):\n                    if limit is not None and count &gt;= limit:\n                        return\n                    yield self._records[current]\n                    current += 1\n                    count += 1\n\n    async def flush(self) -&gt; None:\n        \"\"\"No-op for in-memory storage.\"\"\"\n        pass\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"Return statistics.\"\"\"\n        return {\n            \"bucket_id\": self.bucket_id,\n            \"total_count\": len(self._records),\n            \"buffer_count\": 0,\n            \"persisted_count\": len(self._records),\n        }\n\n    def total_count(self) -&gt; int:\n        \"\"\"Return total record count.\"\"\"\n        return len(self._records)\n</code></pre>"},{"location":"guide/custom/#registering-custom-backends","title":"Registering Custom Backends","text":"<pre><code>import pulsing as pul\n\n# Register your backend\npul.queue.register_backend(\"simple\", SimpleBackend)\n\n# Use it\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"my_topic\",\n    backend=\"simple\",\n)\n</code></pre>"},{"location":"guide/custom/#advanced-implementation","title":"Advanced Implementation","text":""},{"location":"guide/custom/#with-persistence","title":"With Persistence","text":"<pre><code>import json\nfrom pathlib import Path\n\nclass FileBackend:\n    \"\"\"A file-based backend with persistence.\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        **kwargs,\n    ):\n        self.bucket_id = bucket_id\n        self.storage_path = Path(storage_path)\n        self.batch_size = batch_size\n        self._buffer: list[dict[str, Any]] = []\n        self._persisted_count = 0\n        self._condition = asyncio.Condition()\n\n        # Load existing data\n        self._load()\n\n    def _load(self) -&gt; None:\n        \"\"\"Load persisted data.\"\"\"\n        self.storage_path.mkdir(parents=True, exist_ok=True)\n        data_file = self.storage_path / \"data.json\"\n        if data_file.exists():\n            with open(data_file) as f:\n                data = json.load(f)\n                self._persisted_count = len(data)\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        async with self._condition:\n            self._buffer.append(record)\n            if len(self._buffer) &gt;= self.batch_size:\n                await self._flush_internal()\n            self._condition.notify_all()\n\n    async def _flush_internal(self) -&gt; None:\n        \"\"\"Internal flush without lock.\"\"\"\n        if not self._buffer:\n            return\n\n        data_file = self.storage_path / \"data.json\"\n\n        # Load existing\n        existing = []\n        if data_file.exists():\n            with open(data_file) as f:\n                existing = json.load(f)\n\n        # Append new\n        existing.extend(self._buffer)\n\n        # Write back\n        with open(data_file, \"w\") as f:\n            json.dump(existing, f)\n\n        self._persisted_count += len(self._buffer)\n        self._buffer.clear()\n\n    async def flush(self) -&gt; None:\n        \"\"\"Persist buffered data.\"\"\"\n        async with self._condition:\n            await self._flush_internal()\n</code></pre>"},{"location":"guide/custom/#with-blocking-support","title":"With Blocking Support","text":"<p>The <code>get_stream</code> method with <code>block=True</code> should wait for new data:</p> <pre><code>async def get_stream(\n    self,\n    offset: int = 0,\n    limit: int | None = None,\n    block: bool = False\n) -&gt; AsyncIterator[dict[str, Any]]:\n    \"\"\"Stream records with blocking support.\"\"\"\n    current = offset\n    count = 0\n\n    while True:\n        async with self._condition:\n            # Wait for data if blocking\n            while current &gt;= self.total_count():\n                if not block:\n                    return\n                # Wait with timeout to check periodically\n                try:\n                    await asyncio.wait_for(\n                        self._condition.wait(),\n                        timeout=1.0\n                    )\n                except asyncio.TimeoutError:\n                    continue\n\n            # Get available records\n            records = await self.get(current, limit)\n\n        for record in records:\n            if limit is not None and count &gt;= limit:\n                return\n            yield record\n            current += 1\n            count += 1\n</code></pre>"},{"location":"guide/custom/#testing-custom-backends","title":"Testing Custom Backends","text":"<pre><code>import pytest\nimport pulsing as pul\n\n@pytest.fixture\ndef custom_backend():\n    pul.queue.register_backend(\"custom\", CustomBackend)\n    yield\n    # Cleanup if needed\n\n@pytest.mark.asyncio\nasync def test_custom_backend_write_read(actor_system, custom_backend):\n    # Write\n    writer = await pul.queue.write_queue(\n        actor_system,\n        topic=\"test\",\n        backend=\"custom\",\n        storage_path=\"/tmp/test\",\n    )\n\n    await writer.put({\"id\": \"1\", \"value\": 42})\n    await writer.flush()\n\n    # Read\n    reader = await pul.queue.read_queue(actor_system, \"test\")\n    records = await reader.get(limit=10)\n\n    assert len(records) == 1\n    assert records[0][\"id\"] == \"1\"\n</code></pre>"},{"location":"guide/custom/#best-practices","title":"Best Practices","text":"<ol> <li>Thread Safety: Use <code>asyncio.Condition</code> for safe concurrent access</li> <li>Buffering: Buffer writes for better performance</li> <li>Error Handling: Handle storage errors gracefully</li> <li>Statistics: Provide useful stats for monitoring</li> <li>Testing: Write comprehensive tests</li> </ol>"},{"location":"guide/custom/#next-steps","title":"Next Steps","text":"<ul> <li>Architecture - Design details</li> <li>API Reference - Detailed API documentation</li> </ul>"},{"location":"guide/lance/","title":"Lance Backend","text":"<p>The Lance backend provides high-performance persistent storage using the Lance columnar data format.</p>"},{"location":"guide/lance/#overview","title":"Overview","text":"<p>Lance is a modern columnar data format optimized for ML workflows. The <code>LanceBackend</code> brings these capabilities to Pulsing queues:</p> <ul> <li>High-performance random access - Efficient retrieval of any record</li> <li>Columnar storage - Optimal for analytical queries</li> <li>Version control - Built-in data versioning</li> <li>Vector search - Native support for similarity search</li> </ul>"},{"location":"guide/lance/#installation","title":"Installation","text":"<pre><code>pip install persisting[pulsing]\n</code></pre>"},{"location":"guide/lance/#basic-usage","title":"Basic Usage","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# Register the backend\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n# Create writer\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"my_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n)\n\n# Write data\nawait writer.put({\"id\": \"1\", \"text\": \"Hello\", \"vector\": [0.1, 0.2, 0.3]})\nawait writer.put({\"id\": \"2\", \"text\": \"World\", \"vector\": [0.4, 0.5, 0.6]})\n\n# Flush to persist\nawait writer.flush()\n\n# Read data\nreader = await pul.queue.read_queue(system, \"my_topic\")\nrecords = await reader.get(limit=10)\n</code></pre>"},{"location":"guide/lance/#configuration","title":"Configuration","text":""},{"location":"guide/lance/#backend-options","title":"Backend Options","text":"Option Type Default Description <code>flush_threshold</code> int 1000 Records before auto-flush"},{"location":"guide/lance/#example-configuration","title":"Example Configuration","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"configured_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n    batch_size=100,\n    backend_options={\n        \"flush_threshold\": 500,\n    },\n)\n</code></pre>"},{"location":"guide/lance/#data-storage","title":"Data Storage","text":""},{"location":"guide/lance/#directory-structure","title":"Directory Structure","text":"<pre><code>/data/queues/\n\u2514\u2500\u2500 my_topic/\n    \u2514\u2500\u2500 bucket_0/\n        \u251c\u2500\u2500 data.lance/\n        \u2502   \u251c\u2500\u2500 _versions/\n        \u2502   \u2502   \u251c\u2500\u2500 1.manifest\n        \u2502   \u2502   \u2514\u2500\u2500 2.manifest\n        \u2502   \u2514\u2500\u2500 data/\n        \u2502       \u251c\u2500\u2500 0.lance\n        \u2502       \u2514\u2500\u2500 1.lance\n        \u2514\u2500\u2500 ...\n</code></pre>"},{"location":"guide/lance/#schema","title":"Schema","text":"<p>The Lance backend automatically infers schema from the first record:</p> <pre><code># First record defines schema\nawait writer.put({\n    \"id\": \"1\",\n    \"text\": \"Hello\",\n    \"value\": 42,\n    \"vector\": [0.1, 0.2, 0.3],\n})\n\n# Subsequent records must match schema\nawait writer.put({\n    \"id\": \"2\",\n    \"text\": \"World\",\n    \"value\": 100,\n    \"vector\": [0.4, 0.5, 0.6],\n})\n</code></pre>"},{"location":"guide/lance/#performance","title":"Performance","text":""},{"location":"guide/lance/#buffering","title":"Buffering","text":"<p>The Lance backend buffers records in memory before persisting:</p> <pre><code># Records are buffered\nfor i in range(100):\n    await writer.put({\"id\": str(i), \"value\": i})\n\n# Explicit flush persists to disk\nawait writer.flush()\n</code></pre>"},{"location":"guide/lance/#auto-flush","title":"Auto-flush","text":"<p>When <code>flush_threshold</code> is reached, data is automatically persisted:</p> <pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"lance\",\n    backend_options={\"flush_threshold\": 500},\n)\n\n# After 500 records, auto-flush occurs\nfor i in range(600):\n    await writer.put({\"id\": str(i), \"value\": i})\n</code></pre>"},{"location":"guide/lance/#streaming","title":"Streaming","text":"<p>The Lance backend supports efficient streaming:</p> <pre><code>import pulsing as pul\n\nreader = await pul.queue.read_queue(system, \"my_topic\")\n\n# Non-blocking stream\nasync for record in reader.get_stream(offset=0, limit=100):\n    process(record)\n\n# Blocking stream (waits for new data)\nasync for record in reader.get_stream(block=True):\n    process(record)\n</code></pre>"},{"location":"guide/lance/#statistics","title":"Statistics","text":"<p>Get storage statistics:</p> <pre><code>stats = await writer.stats()\nprint(f\"Total records: {stats['total_count']}\")\nprint(f\"Buffered: {stats['buffer_count']}\")\nprint(f\"Persisted: {stats['persisted_count']}\")\n</code></pre>"},{"location":"guide/lance/#best-practices","title":"Best Practices","text":"<ol> <li>Choose appropriate batch size - Larger batches improve write throughput</li> <li>Flush regularly - Call <code>flush()</code> to ensure data durability</li> <li>Use appropriate storage path - Use fast SSD storage for production</li> <li>Monitor buffer size - Avoid memory pressure with large buffers</li> </ol>"},{"location":"guide/lance/#next-steps","title":"Next Steps","text":"<ul> <li>Persisting Backend - Enhanced features with WAL</li> <li>Custom Backends - Implement your own backend</li> <li>API Reference - Detailed API documentation</li> </ul>"},{"location":"guide/persisting/","title":"Persisting Backend","text":"<p>The Persisting backend extends the Lance backend with enterprise-grade features for production deployments.</p>"},{"location":"guide/persisting/#overview","title":"Overview","text":"<p><code>PersistingBackend</code> provides all Lance features plus:</p> <ul> <li>Write-Ahead Log (WAL) - Crash recovery and data durability</li> <li>Schema Evolution - Dynamic schema changes without downtime</li> <li>Compression - Multiple compression algorithms</li> <li>Monitoring - Prometheus metrics export</li> </ul>"},{"location":"guide/persisting/#installation","title":"Installation","text":"<pre><code>pip install persisting[pulsing]\n</code></pre>"},{"location":"guide/persisting/#basic-usage","title":"Basic Usage","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# Register the backend\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\n\n# Create writer with enhanced features\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"production_topic\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n        \"enable_metrics\": True,\n    },\n)\n\n# Write data\nawait writer.put({\"id\": \"1\", \"value\": 42})\nawait writer.flush()\n</code></pre>"},{"location":"guide/persisting/#configuration","title":"Configuration","text":""},{"location":"guide/persisting/#backend-options","title":"Backend Options","text":"Option Type Default Description <code>enable_wal</code> bool False Enable Write-Ahead Log <code>compression</code> str None Compression: \"zstd\", \"lz4\", \"snappy\" <code>enable_metrics</code> bool False Enable Prometheus metrics <code>wal_sync_interval</code> float 1.0 WAL sync interval in seconds <code>max_wal_size</code> int 100MB Maximum WAL file size"},{"location":"guide/persisting/#full-configuration-example","title":"Full Configuration Example","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"advanced_topic\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    batch_size=100,\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n        \"enable_metrics\": True,\n        \"wal_sync_interval\": 0.5,\n        \"max_wal_size\": 50 * 1024 * 1024,  # 50MB\n    },\n)\n</code></pre>"},{"location":"guide/persisting/#write-ahead-log-wal","title":"Write-Ahead Log (WAL)","text":""},{"location":"guide/persisting/#overview_1","title":"Overview","text":"<p>WAL ensures data durability by writing changes to a log before applying them:</p> <pre><code>Write Request \u2192 WAL \u2192 Buffer \u2192 Lance Storage\n                \u2193\n           (Crash Recovery)\n</code></pre>"},{"location":"guide/persisting/#enabling-wal","title":"Enabling WAL","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    backend_options={\"enable_wal\": True},\n)\n</code></pre>"},{"location":"guide/persisting/#recovery","title":"Recovery","text":"<p>On startup, the backend automatically recovers uncommitted data from WAL:</p> <pre><code>import pulsing as pul\n\n# After a crash, data is recovered automatically\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    backend_options={\"enable_wal\": True},\n)\n# All uncommitted data is now available\n</code></pre>"},{"location":"guide/persisting/#schema-evolution","title":"Schema Evolution","text":""},{"location":"guide/persisting/#adding-fields","title":"Adding Fields","text":"<pre><code># Original schema\nawait writer.put({\"id\": \"1\", \"name\": \"Alice\"})\n\n# Add new field (with default)\nawait writer.put({\"id\": \"2\", \"name\": \"Bob\", \"age\": 30})\n\n# Missing fields get default values\n</code></pre>"},{"location":"guide/persisting/#field-type-changes","title":"Field Type Changes","text":"<pre><code># PersistingBackend handles compatible type changes\n# int \u2192 float, etc.\n</code></pre>"},{"location":"guide/persisting/#compression","title":"Compression","text":""},{"location":"guide/persisting/#available-algorithms","title":"Available Algorithms","text":"Algorithm Ratio Speed Use Case <code>zstd</code> High Medium General purpose <code>lz4</code> Medium Fast Low latency <code>snappy</code> Low Very Fast Real-time"},{"location":"guide/persisting/#example","title":"Example","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    backend_options={\"compression\": \"zstd\"},\n)\n</code></pre>"},{"location":"guide/persisting/#monitoring","title":"Monitoring","text":""},{"location":"guide/persisting/#prometheus-metrics","title":"Prometheus Metrics","text":"<p>When <code>enable_metrics=True</code>, the following metrics are exported:</p> Metric Type Description <code>persisting_records_total</code> Counter Total records written <code>persisting_buffer_size</code> Gauge Current buffer size <code>persisting_flush_duration_seconds</code> Histogram Flush latency <code>persisting_wal_size_bytes</code> Gauge WAL file size"},{"location":"guide/persisting/#accessing-metrics","title":"Accessing Metrics","text":"<pre><code># Get current stats\nstats = await writer.stats()\nprint(stats)\n# {\n#     'total_count': 1000,\n#     'buffer_count': 50,\n#     'persisted_count': 950,\n#     'wal_size': 1024000,\n#     'compression': 'zstd',\n# }\n</code></pre>"},{"location":"guide/persisting/#best-practices","title":"Best Practices","text":""},{"location":"guide/persisting/#production-configuration","title":"Production Configuration","text":"<pre><code>import pulsing as pul\n\n# Recommended production settings\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"production\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    batch_size=1000,\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n        \"enable_metrics\": True,\n        \"wal_sync_interval\": 0.1,  # Low latency\n    },\n)\n</code></pre>"},{"location":"guide/persisting/#high-throughput","title":"High Throughput","text":"<pre><code>import pulsing as pul\n\n# For high throughput workloads\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"high_throughput\",\n    backend=\"persisting\",\n    batch_size=10000,\n    backend_options={\n        \"enable_wal\": False,  # Trade durability for speed\n        \"compression\": \"lz4\",  # Fast compression\n    },\n)\n</code></pre>"},{"location":"guide/persisting/#high-durability","title":"High Durability","text":"<pre><code>import pulsing as pul\n\n# For critical data\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"critical_data\",\n    backend=\"persisting\",\n    batch_size=100,\n    backend_options={\n        \"enable_wal\": True,\n        \"wal_sync_interval\": 0.0,  # Sync every write\n        \"compression\": \"zstd\",\n    },\n)\n</code></pre>"},{"location":"guide/persisting/#comparison-with-lance-backend","title":"Comparison with Lance Backend","text":"Feature Lance Persisting Basic persistence \u2705 \u2705 Version control \u2705 \u2705 Vector search \u2705 \u2705 WAL \u274c \u2705 Schema evolution \u274c \u2705 Compression options Limited Full Prometheus metrics \u274c \u2705"},{"location":"guide/persisting/#next-steps","title":"Next Steps","text":"<ul> <li>Custom Backends - Implement your own backend</li> <li>Architecture - Design details</li> <li>API Reference - Detailed API documentation</li> </ul>"},{"location":"zh/","title":"Persisting - AI \u200b\u7cfb\u7edf\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8","text":""},{"location":"zh/#persisting","title":"Persisting","text":"<p>Persisting \u200b\u662f\u200b\u4e3a\u200b AI \u200b\u7cfb\u7edf\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u200b\u89e3\u51b3\u65b9\u6848\u200b\uff0c\u200b\u4e3a\u200b\u53c2\u6570\u200b\u3001KV Cache \u200b\u548c\u200b Trajectory \u200b\u63d0\u4f9b\u200b\u9ad8\u6548\u200b\u5b58\u50a8\u200b\u3002</p>"},{"location":"zh/#_1","title":"\u6838\u5fc3\u200b\u7279\u6027","text":"<ul> <li>\u200b\u53ef\u200b\u63d2\u62d4\u200b\u540e\u200b\u7aef\u200b - \u200b\u652f\u6301\u200b\u591a\u79cd\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u5305\u62ec\u200b\u5185\u5b58\u200b\u3001Lance \u200b\u548c\u200b\u81ea\u5b9a\u4e49\u200b\u5b9e\u73b0\u200b\u3002</li> <li>Lance \u200b\u96c6\u6210\u200b - \u200b\u57fa\u4e8e\u200b Lance \u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b\u683c\u5f0f\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u9ad8\u6027\u80fd\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b\u548c\u200b\u96f6\u200b\u62f7\u8d1d\u200b\u7248\u672c\u63a7\u5236\u200b\u3002</li> <li>Write-Ahead Log - \u200b\u5185\u7f6e\u200b WAL \u200b\u652f\u6301\u200b\uff0c\u200b\u786e\u4fdd\u200b\u6570\u636e\u200b\u6301\u4e45\u6027\u200b\u548c\u200b\u5d29\u6e83\u200b\u6062\u590d\u200b\u3002</li> <li>Pulsing \u200b\u96c6\u6210\u200b - \u200b\u4e0e\u200b Pulsing Actor \u200b\u6846\u67b6\u200b\u65e0\u7f1d\u200b\u96c6\u6210\u200b\uff0c\u200b\u4e3a\u200b\u5206\u5e03\u5f0f\u200b\u961f\u5217\u200b\u63d0\u4f9b\u200b\u6301\u4e45\u200b\u5316\u200b\u80fd\u529b\u200b\u3002</li> <li>Schema \u200b\u6f14\u8fdb\u200b - \u200b\u652f\u6301\u200b\u52a8\u6001\u200b Schema \u200b\u6f14\u8fdb\u200b\uff0c\u200b\u65e0\u9700\u200b\u505c\u673a\u200b\u3002</li> <li>\u200b\u76d1\u63a7\u200b\u6307\u6807\u200b - \u200b\u5185\u7f6e\u200b Prometheus \u200b\u6307\u6807\u200b\u5bfc\u51fa\u200b\uff0c\u200b\u5b9e\u65f6\u200b\u76d1\u63a7\u200b\u5b58\u50a8\u72b6\u6001\u200b\u3002</li> </ul>"},{"location":"zh/#_2","title":"\u5feb\u901f\u200b\u5f00\u59cb","text":"<pre><code># \u200b\u5b89\u88c5\u200b\npip install persisting\n\n# \u200b\u6216\u200b\u4e0e\u200b Pulsing \u200b\u4e00\u8d77\u200b\u5b89\u88c5\u200b\npip install persisting[pulsing]\n</code></pre> <pre><code>import pulsing as pul\nimport persisting as pst\n\n# \u200b\u6ce8\u518c\u200b Lance \u200b\u540e\u200b\u7aef\u200b\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n# \u200b\u4f7f\u7528\u200b\u6301\u4e45\u200b\u5316\u200b\u961f\u5217\u200b\nwriter = await pul.queue.write_queue(system, \"my_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\")\n\nawait writer.put({\"id\": \"1\", \"value\": 42})\nawait writer.flush()\n</code></pre>"},{"location":"zh/#_3","title":"\u5e94\u7528\u200b\u573a\u666f","text":"<ul> <li>KV Cache \u200b\u5b58\u50a8\u200b - \u200b\u5b58\u50a8\u200b\u548c\u200b\u68c0\u7d22\u200b LLM KV Cache\uff0c\u200b\u652f\u6301\u200b\u8de8\u4f1a\u8bdd\u200b\u590d\u7528\u200b\u3002</li> <li>Trajectory \u200b\u5b58\u50a8\u200b - \u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u200b\u5f3a\u5316\u200b\u5b66\u4e60\u200b\u548c\u200b\u8bad\u7ec3\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u7684\u200b Trajectory \u200b\u6570\u636e\u200b\u3002</li> <li>\u200b\u53c2\u6570\u200b\u68c0\u67e5\u70b9\u200b - \u200b\u9ad8\u6548\u200b\u7684\u200b\u6a21\u578b\u200b\u53c2\u6570\u200b\u68c0\u67e5\u70b9\u200b\u5b58\u50a8\u200b\uff0c\u200b\u652f\u6301\u200b\u7248\u672c\u200b\u7ba1\u7406\u200b\u3002</li> </ul>"},{"location":"zh/#_4","title":"\u793e\u533a","text":"<ul> <li>GitHub \u200b\u4ed3\u5e93\u200b</li> <li>\u200b\u95ee\u9898\u200b\u8ffd\u8e2a\u200b</li> <li>\u200b\u8ba8\u8bba\u533a\u200b</li> </ul>"},{"location":"zh/api_reference/","title":"API \u200b\u53c2\u8003","text":"<p>\u200b\u672c\u200b\u6587\u6863\u200b\u63d0\u4f9b\u200b Persisting \u200b\u7684\u200b\u8be6\u7ec6\u200b API \u200b\u53c2\u8003\u200b\u3002</p>"},{"location":"zh/api_reference/#lancebackend","title":"LanceBackend","text":"<p>\u200b\u4f7f\u7528\u200b Lance \u200b\u5217\u5f0f\u200b\u683c\u5f0f\u200b\u7684\u200b\u9ad8\u6027\u80fd\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002</p> <pre><code>class LanceBackend:\n    \"\"\"\u200b\u57fa\u4e8e\u200b Lance \u200b\u7684\u200b Pulsing \u200b\u961f\u5217\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        flush_threshold: int = 1000,\n        **kwargs,\n    ) -&gt; None:\n        \"\"\"\n        \u200b\u521d\u59cb\u5316\u200b Lance \u200b\u540e\u200b\u7aef\u200b\u3002\n\n        \u200b\u53c2\u6570\u200b\n        ----------\n        bucket_id : int\n            \u200b\u6b64\u200b bucket \u200b\u7684\u200b\u552f\u4e00\u200b\u6807\u8bc6\u7b26\u200b\u3002\n        storage_path : str\n            \u200b\u5b58\u50a8\u200b Lance \u200b\u6570\u636e\u200b\u96c6\u200b\u7684\u200b\u8def\u5f84\u200b\u3002\n        batch_size : int, \u200b\u53ef\u200b\u9009\u200b\n            \u200b\u64cd\u4f5c\u200b\u7684\u200b\u6279\u6b21\u200b\u5927\u5c0f\u200b\uff08\u200b\u9ed8\u8ba4\u200b: 100\uff09\u3002\n        flush_threshold : int, \u200b\u53ef\u200b\u9009\u200b\n            \u200b\u81ea\u52a8\u200b\u5237\u65b0\u200b\u524d\u200b\u7684\u200b\u8bb0\u5f55\u200b\u6570\u200b\uff08\u200b\u9ed8\u8ba4\u200b: 1000\uff09\u3002\n        **kwargs\n            \u200b\u5176\u4ed6\u200b\u9009\u9879\u200b\uff08\u200b\u5ffd\u7565\u200b\uff09\u3002\n        \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#_1","title":"\u65b9\u6cd5","text":""},{"location":"zh/api_reference/#put","title":"put","text":"<pre><code>async def put(self, record: dict[str, Any]) -&gt; None:\n    \"\"\"\n    \u200b\u5b58\u50a8\u200b\u5355\u6761\u200b\u8bb0\u5f55\u200b\u3002\n\n    \u200b\u53c2\u6570\u200b\n    ----------\n    record : dict[str, Any]\n        \u200b\u8981\u200b\u5b58\u50a8\u200b\u7684\u200b\u8bb0\u5f55\u200b\u3002\n    \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#put_batch","title":"put_batch","text":"<pre><code>async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n    \"\"\"\n    \u200b\u9ad8\u6548\u200b\u5b58\u50a8\u200b\u591a\u6761\u200b\u8bb0\u5f55\u200b\u3002\n\n    \u200b\u53c2\u6570\u200b\n    ----------\n    records : list[dict[str, Any]]\n        \u200b\u8981\u200b\u5b58\u50a8\u200b\u7684\u200b\u8bb0\u5f55\u200b\u3002\n    \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#get","title":"get","text":"<pre><code>async def get(\n    self,\n    offset: int = 0,\n    limit: int | None = None,\n) -&gt; list[dict[str, Any]]:\n    \"\"\"\n    \u200b\u4ece\u200b\u5b58\u50a8\u200b\u68c0\u7d22\u200b\u8bb0\u5f55\u200b\u3002\n\n    \u200b\u53c2\u6570\u200b\n    ----------\n    offset : int, \u200b\u53ef\u200b\u9009\u200b\n        \u200b\u8d77\u59cb\u200b\u504f\u79fb\u91cf\u200b\uff08\u200b\u9ed8\u8ba4\u200b: 0\uff09\u3002\n    limit : int | None, \u200b\u53ef\u200b\u9009\u200b\n        \u200b\u8fd4\u56de\u200b\u7684\u200b\u6700\u5927\u200b\u8bb0\u5f55\u200b\u6570\u200b\uff08\u200b\u9ed8\u8ba4\u200b: None = \u200b\u5168\u90e8\u200b\uff09\u3002\n\n    \u200b\u8fd4\u56de\u200b\n    -------\n    list[dict[str, Any]]\n        \u200b\u68c0\u7d22\u200b\u5230\u200b\u7684\u200b\u8bb0\u5f55\u200b\u3002\n    \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#get_stream","title":"get_stream","text":"<pre><code>async def get_stream(\n    self,\n    offset: int = 0,\n    limit: int | None = None,\n    block: bool = False,\n) -&gt; AsyncIterator[dict[str, Any]]:\n    \"\"\"\n    \u200b\u4ece\u200b\u5b58\u50a8\u200b\u6d41\u5f0f\u200b\u8bfb\u53d6\u200b\u8bb0\u5f55\u200b\u3002\n\n    \u200b\u53c2\u6570\u200b\n    ----------\n    offset : int, \u200b\u53ef\u200b\u9009\u200b\n        \u200b\u8d77\u59cb\u200b\u504f\u79fb\u91cf\u200b\uff08\u200b\u9ed8\u8ba4\u200b: 0\uff09\u3002\n    limit : int | None, \u200b\u53ef\u200b\u9009\u200b\n        \u200b\u8fd4\u56de\u200b\u7684\u200b\u6700\u5927\u200b\u8bb0\u5f55\u200b\u6570\u200b\uff08\u200b\u9ed8\u8ba4\u200b: None = \u200b\u65e0\u200b\u9650\u5236\u200b\uff09\u3002\n    block : bool, \u200b\u53ef\u200b\u9009\u200b\n        \u200b\u5982\u679c\u200b\u4e3a\u200b True\uff0c\u200b\u8ffd\u4e0a\u200b\u65f6\u200b\u7b49\u5f85\u200b\u65b0\u200b\u8bb0\u5f55\u200b\uff08\u200b\u9ed8\u8ba4\u200b: False\uff09\u3002\n\n    \u200b\u751f\u6210\u200b\n    ------\n    dict[str, Any]\n        \u200b\u6765\u81ea\u200b\u5b58\u50a8\u200b\u7684\u200b\u8bb0\u5f55\u200b\u3002\n    \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#flush","title":"flush","text":"<pre><code>async def flush(self) -&gt; None:\n    \"\"\"\n    \u200b\u5c06\u200b\u7f13\u51b2\u200b\u6570\u636e\u200b\u6301\u4e45\u200b\u5316\u5230\u200b Lance \u200b\u5b58\u50a8\u200b\u3002\n\n    \u200b\u5c06\u200b\u6240\u6709\u200b\u7f13\u51b2\u200b\u8bb0\u5f55\u200b\u5199\u5165\u200b Lance \u200b\u6570\u636e\u200b\u96c6\u200b\u5e76\u200b\u6e05\u7a7a\u200b\u7f13\u51b2\u533a\u200b\u3002\n    \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#stats","title":"stats","text":"<pre><code>async def stats(self) -&gt; dict[str, Any]:\n    \"\"\"\n    \u200b\u83b7\u53d6\u200b\u5b58\u50a8\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u3002\n\n    \u200b\u8fd4\u56de\u200b\n    -------\n    dict[str, Any]\n        \u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u5305\u62ec\u200b:\n        - bucket_id: Bucket \u200b\u6807\u8bc6\u7b26\u200b\n        - total_count: \u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b\n        - buffer_count: \u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u8bb0\u5f55\u200b\u6570\u200b\n        - persisted_count: Lance \u200b\u4e2d\u200b\u7684\u200b\u8bb0\u5f55\u200b\u6570\u200b\n        - storage_path: Lance \u200b\u6570\u636e\u200b\u96c6\u200b\u8def\u5f84\u200b\n    \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#total_count","title":"total_count","text":"<pre><code>def total_count(self) -&gt; int:\n    \"\"\"\n    \u200b\u83b7\u53d6\u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b\u3002\n\n    \u200b\u8fd4\u56de\u200b\n    -------\n    int\n        \u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b\uff08\u200b\u7f13\u51b2\u533a\u200b + \u200b\u5df2\u200b\u6301\u4e45\u200b\u5316\u200b\uff09\u3002\n    \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#persistingbackend","title":"PersistingBackend","text":"<p>\u200b\u5e26\u200b WAL\u3001\u200b\u538b\u7f29\u200b\u548c\u200b\u6307\u6807\u200b\u7684\u200b\u589e\u5f3a\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002</p> <pre><code>class PersistingBackend:\n    \"\"\"\u200b\u5e26\u200b\u4f01\u4e1a\u7ea7\u200b\u529f\u80fd\u200b\u7684\u200b\u589e\u5f3a\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        enable_wal: bool = False,\n        compression: str | None = None,\n        enable_metrics: bool = False,\n        wal_sync_interval: float = 1.0,\n        max_wal_size: int = 100 * 1024 * 1024,\n        **kwargs,\n    ) -&gt; None:\n        \"\"\"\n        \u200b\u521d\u59cb\u5316\u200b Persisting \u200b\u540e\u200b\u7aef\u200b\u3002\n\n        \u200b\u53c2\u6570\u200b\n        ----------\n        bucket_id : int\n            \u200b\u6b64\u200b bucket \u200b\u7684\u200b\u552f\u4e00\u200b\u6807\u8bc6\u7b26\u200b\u3002\n        storage_path : str\n            \u200b\u5b58\u50a8\u200b\u6570\u636e\u200b\u7684\u200b\u8def\u5f84\u200b\u3002\n        batch_size : int, \u200b\u53ef\u200b\u9009\u200b\n            \u200b\u64cd\u4f5c\u200b\u7684\u200b\u6279\u6b21\u200b\u5927\u5c0f\u200b\uff08\u200b\u9ed8\u8ba4\u200b: 100\uff09\u3002\n        enable_wal : bool, \u200b\u53ef\u200b\u9009\u200b\n            \u200b\u542f\u7528\u200b Write-Ahead Log\uff08\u200b\u9ed8\u8ba4\u200b: False\uff09\u3002\n        compression : str | None, \u200b\u53ef\u200b\u9009\u200b\n            \u200b\u538b\u7f29\u7b97\u6cd5\u200b: \"zstd\", \"lz4\", \"snappy\"\uff08\u200b\u9ed8\u8ba4\u200b: None\uff09\u3002\n        enable_metrics : bool, \u200b\u53ef\u200b\u9009\u200b\n            \u200b\u542f\u7528\u200b Prometheus \u200b\u6307\u6807\u200b\uff08\u200b\u9ed8\u8ba4\u200b: False\uff09\u3002\n        wal_sync_interval : float, \u200b\u53ef\u200b\u9009\u200b\n            WAL \u200b\u540c\u6b65\u200b\u95f4\u9694\u200b\uff08\u200b\u79d2\u200b\uff09\uff08\u200b\u9ed8\u8ba4\u200b: 1.0\uff09\u3002\n        max_wal_size : int, \u200b\u53ef\u200b\u9009\u200b\n            \u200b\u6700\u5927\u200b WAL \u200b\u6587\u4ef6\u5927\u5c0f\u200b\uff08\u200b\u5b57\u8282\u200b\uff09\uff08\u200b\u9ed8\u8ba4\u200b: 100MB\uff09\u3002\n        **kwargs\n            \u200b\u5176\u4ed6\u200b\u9009\u9879\u200b\uff08\u200b\u5ffd\u7565\u200b\uff09\u3002\n        \"\"\"\n</code></pre>"},{"location":"zh/api_reference/#_2","title":"\u65b9\u6cd5","text":"<p>\u200b\u7ee7\u627f\u200b <code>LanceBackend</code> \u200b\u7684\u200b\u6240\u6709\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u589e\u5f3a\u200b\u884c\u4e3a\u200b\uff1a</p> <ul> <li><code>put()</code> - \u200b\u5982\u679c\u200b\u542f\u7528\u200b\u5219\u200b\u9996\u5148\u200b\u5199\u5165\u200b WAL</li> <li><code>flush()</code> - \u200b\u6210\u529f\u200b\u5237\u65b0\u200b\u540e\u200b\u622a\u65ad\u200b WAL</li> <li><code>stats()</code> - \u200b\u5305\u542b\u200b WAL \u200b\u548c\u200b\u538b\u7f29\u200b\u4fe1\u606f\u200b</li> </ul>"},{"location":"zh/api_reference/#_3","title":"\u4f7f\u7528\u200b\u793a\u4f8b","text":""},{"location":"zh/api_reference/#_4","title":"\u57fa\u672c\u200b\u7528\u6cd5","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# \u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef\u200b\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n# \u200b\u521b\u5efa\u200b\u5199\u5165\u200b\u5668\u200b\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"example\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n)\n\n# \u200b\u5199\u5165\u200b\u6570\u636e\u200b\nawait writer.put({\"id\": \"1\", \"value\": 42})\nawait writer.flush()\n\n# \u200b\u8bfb\u53d6\u6570\u636e\u200b\nreader = await pul.queue.read_queue(system, \"example\")\nrecords = await reader.get(limit=10)\n</code></pre>"},{"location":"zh/api_reference/#wal","title":"\u4f7f\u7528\u200b WAL","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"durable\",\n    backend=\"persisting\",\n    backend_options={\n        \"enable_wal\": True,\n        \"wal_sync_interval\": 0.1,\n    },\n)\n</code></pre>"},{"location":"zh/api_reference/#_5","title":"\u6d41\u5f0f\u200b\u5904\u7406","text":"<pre><code>import pulsing as pul\n\nreader = await pul.queue.read_queue(system, \"example\")\n\n# \u200b\u975e\u200b\u963b\u585e\u200b\u6d41\u200b\nasync for record in reader.get_stream(limit=100):\n    process(record)\n\n# \u200b\u963b\u585e\u200b\u6d41\u200b\uff08\u200b\u7b49\u5f85\u200b\u65b0\u200b\u6570\u636e\u200b\uff09\nasync for record in reader.get_stream(block=True):\n    process(record)\n</code></pre>"},{"location":"zh/api_reference/#_6","title":"\u5f02\u5e38","text":""},{"location":"zh/api_reference/#storageerror","title":"StorageError","text":"<p>\u200b\u5b58\u50a8\u200b\u64cd\u4f5c\u200b\u7684\u200b\u57fa\u7840\u200b\u5f02\u5e38\u200b\u3002</p> <pre><code>class StorageError(Exception):\n    \"\"\"\u200b\u5b58\u50a8\u200b\u64cd\u4f5c\u200b\u7684\u200b\u57fa\u7840\u200b\u5f02\u5e38\u200b\u3002\"\"\"\n    pass\n</code></pre>"},{"location":"zh/api_reference/#walerror","title":"WALError","text":"<p>WAL \u200b\u76f8\u5173\u200b\u9519\u8bef\u200b\u7684\u200b\u5f02\u5e38\u200b\u3002</p> <pre><code>class WALError(StorageError):\n    \"\"\"WAL \u200b\u64cd\u4f5c\u200b\u7684\u200b\u5f02\u5e38\u200b\u3002\"\"\"\n    pass\n</code></pre>"},{"location":"zh/api_reference/#_7","title":"\u7c7b\u578b\u5b9a\u4e49","text":""},{"location":"zh/api_reference/#storagebackend","title":"StorageBackend \u200b\u534f\u8bae","text":"<pre><code>from typing import Protocol, AsyncIterator, Any\n\nclass StorageBackend(Protocol):\n    \"\"\"\u200b\u53ef\u200b\u63d2\u62d4\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u7684\u200b\u534f\u8bae\u200b\u3002\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None: ...\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None: ...\n    async def get(self, offset: int = 0, limit: int | None = None) -&gt; list[dict[str, Any]]: ...\n    async def get_stream(\n        self, offset: int = 0, limit: int | None = None, block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]: ...\n    async def flush(self) -&gt; None: ...\n    async def stats(self) -&gt; dict[str, Any]: ...\n    def total_count(self) -&gt; int: ...\n</code></pre>"},{"location":"zh/installation/","title":"\u5b89\u88c5\u200b\u6307\u5357","text":"<p>\u200b\u672c\u200b\u6307\u5357\u200b\u4ecb\u7ecd\u200b\u5982\u4f55\u200b\u5b89\u88c5\u200b Persisting\u3002</p>"},{"location":"zh/installation/#_2","title":"\u73af\u5883\u200b\u8981\u6c42","text":"<ul> <li>Python 3.10 \u200b\u6216\u200b\u66f4\u200b\u9ad8\u200b\u7248\u672c\u200b</li> <li>pip \u200b\u6216\u200b uv \u200b\u5305\u200b\u7ba1\u7406\u5668\u200b</li> </ul>"},{"location":"zh/installation/#_3","title":"\u5b89\u88c5\u200b\u65b9\u5f0f","text":""},{"location":"zh/installation/#pip","title":"\u4f7f\u7528\u200b pip","text":"<pre><code># \u200b\u57fa\u7840\u200b\u5b89\u88c5\u200b\npip install persisting\n\n# \u200b\u5305\u542b\u200b Pulsing \u200b\u96c6\u6210\u200b\npip install persisting[pulsing]\n\n# \u200b\u5305\u542b\u200b\u6240\u6709\u200b\u53ef\u200b\u9009\u200b\u4f9d\u8d56\u200b\npip install persisting[all]\n</code></pre>"},{"location":"zh/installation/#uv","title":"\u4f7f\u7528\u200b uv","text":"<pre><code># \u200b\u57fa\u7840\u200b\u5b89\u88c5\u200b\nuv pip install persisting\n\n# \u200b\u5305\u542b\u200b Pulsing \u200b\u96c6\u6210\u200b\nuv pip install persisting[pulsing]\n</code></pre>"},{"location":"zh/installation/#_4","title":"\u4ece\u200b\u6e90\u7801\u200b\u5b89\u88c5","text":"<pre><code># \u200b\u514b\u9686\u200b\u4ed3\u5e93\u200b\ngit clone https://github.com/reiase/Persisting.git\ncd Persisting\n\n# \u200b\u5f00\u53d1\u200b\u6a21\u5f0f\u200b\u5b89\u88c5\u200b\npip install -e .\n\n# \u200b\u6216\u200b\u4f7f\u7528\u200b uv\nuv pip install -e .\n</code></pre>"},{"location":"zh/installation/#_5","title":"\u4f9d\u8d56\u200b\u9879","text":"<p>Persisting \u200b\u6709\u200b\u4ee5\u4e0b\u200b\u4f9d\u8d56\u200b\uff1a</p> \u200b\u5305\u540d\u200b \u200b\u7248\u672c\u200b \u200b\u8bf4\u660e\u200b <code>lance</code> &gt;=0.9.0 Lance \u200b\u5217\u5f0f\u200b\u6570\u636e\u683c\u5f0f\u200b <code>pyarrow</code> &gt;=14.0.0 Apache Arrow \u200b\u6570\u636e\u4ea4\u6362\u200b <code>pulsing</code> &gt;=0.1.0 (\u200b\u53ef\u200b\u9009\u200b) Pulsing Actor \u200b\u6846\u67b6"},{"location":"zh/installation/#_6","title":"\u9a8c\u8bc1\u200b\u5b89\u88c5","text":"<p>\u200b\u9a8c\u8bc1\u200b\u5b89\u88c5\u200b\u662f\u5426\u200b\u6210\u529f\u200b\uff1a</p> <pre><code>import persisting\nprint(persisting.__version__)\n\n# \u200b\u68c0\u67e5\u200b\u53ef\u7528\u200b\u540e\u200b\u7aef\u200b\nfrom persisting.queue import LanceBackend, PersistingBackend\nprint(\"LanceBackend \u200b\u53ef\u7528\u200b:\", LanceBackend is not None)\nprint(\"PersistingBackend \u200b\u53ef\u7528\u200b:\", PersistingBackend is not None)\n</code></pre>"},{"location":"zh/installation/#_7","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u5feb\u901f\u200b\u5f00\u59cb\u200b - \u200b\u5f00\u59cb\u200b\u4f7f\u7528\u200b Persisting</li> <li>\u200b\u7528\u6237\u200b\u6307\u5357\u200b - \u200b\u4e86\u89e3\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b</li> <li>API \u200b\u53c2\u8003\u200b - \u200b\u8be6\u7ec6\u200b API \u200b\u6587\u6863\u200b</li> </ul>"},{"location":"zh/quickstart/","title":"\u5feb\u901f\u200b\u5f00\u59cb","text":"<p>\u200b\u672c\u200b\u6307\u5357\u200b\u5c06\u200b\u5e2e\u52a9\u200b\u4f60\u200b\u5728\u200b\u51e0\u5206\u949f\u200b\u5185\u200b\u5f00\u59cb\u200b\u4f7f\u7528\u200b Persisting\u3002</p>"},{"location":"zh/quickstart/#_2","title":"\u57fa\u672c\u200b\u7528\u6cd5","text":""},{"location":"zh/quickstart/#1-persisting","title":"\u6b65\u9aa4\u200b 1\uff1a\u200b\u5b89\u88c5\u200b Persisting","text":"<pre><code>pip install persisting[pulsing]\n</code></pre>"},{"location":"zh/quickstart/#2-pulsing","title":"\u6b65\u9aa4\u200b 2\uff1a\u200b\u5411\u200b Pulsing \u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# \u200b\u6ce8\u518c\u200b Lance \u200b\u540e\u200b\u7aef\u200b\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n</code></pre>"},{"location":"zh/quickstart/#3","title":"\u6b65\u9aa4\u200b 3\uff1a\u200b\u521b\u5efa\u200b\u6301\u4e45\u200b\u5316\u200b\u961f\u5217","text":"<pre><code>import asyncio\nimport pulsing as pul\nimport persisting as pst\n\nasync def main():\n    # \u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef\u200b\n    pul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n    # \u200b\u521b\u5efa\u200b Actor \u200b\u7cfb\u7edf\u200b\n    system = await pul.actor.create_actor_system(pul.actor.SystemConfig.standalone())\n\n    # \u200b\u521b\u5efa\u200b\u4f7f\u7528\u200b Lance \u200b\u6301\u4e45\u200b\u5316\u200b\u7684\u200b\u961f\u5217\u200b\u5199\u5165\u200b\u5668\u200b\n    writer = await pul.queue.write_queue(\n        system,\n        topic=\"my_data\",\n        backend=\"lance\",\n        storage_path=\"/data/queues\",\n        num_buckets=4,\n        batch_size=100,\n    )\n\n    # \u200b\u5199\u5165\u200b\u6570\u636e\u200b\n    for i in range(10):\n        await writer.put({\"id\": str(i), \"value\": i * 10})\n\n    # \u200b\u5237\u65b0\u200b\u4ee5\u200b\u6301\u4e45\u200b\u5316\u200b\n    await writer.flush()\n\n    # \u200b\u521b\u5efa\u200b\u961f\u5217\u200b\u8bfb\u53d6\u5668\u200b\n    reader = await pul.queue.read_queue(system, \"my_data\")\n\n    # \u200b\u8bfb\u53d6\u6570\u636e\u200b\n    async for record in reader.get_stream():\n        print(f\"\u200b\u8bfb\u53d6\u200b: {record}\")\n\n    await system.shutdown()\n\nasyncio.run(main())\n</code></pre>"},{"location":"zh/quickstart/#_3","title":"\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u540e\u200b\u7aef","text":""},{"location":"zh/quickstart/#_4","title":"\u5185\u5b58\u200b\u540e\u200b\u7aef\u200b\uff08\u200b\u7528\u4e8e\u200b\u6d4b\u8bd5\u200b\uff09","text":"<pre><code>import pulsing as pul\n\n# \u200b\u5185\u5b58\u200b\u540e\u7aef\u200b\u5185\u200b\u7f6e\u4e8e\u200b Pulsing\uff08\u200b\u65e0\u200b\u6301\u4e45\u200b\u5316\u200b\uff09\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"test_topic\",\n    backend=\"memory\",\n)\n</code></pre>"},{"location":"zh/quickstart/#lance","title":"Lance \u200b\u540e\u200b\u7aef\u200b\uff08\u200b\u63a8\u8350\u200b\u7528\u4e8e\u200b\u751f\u4ea7\u200b\uff09","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"prod_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n)\n</code></pre>"},{"location":"zh/quickstart/#persisting","title":"Persisting \u200b\u540e\u200b\u7aef\u200b\uff08\u200b\u589e\u5f3a\u200b\u529f\u80fd\u200b\uff09","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"advanced_topic\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n    },\n)\n</code></pre>"},{"location":"zh/quickstart/#_5","title":"\u540e\u200b\u7aef\u200b\u9009\u9879","text":""},{"location":"zh/quickstart/#lance_1","title":"Lance \u200b\u540e\u200b\u7aef\u200b\u9009\u9879","text":"\u9009\u9879\u200b \u200b\u7c7b\u578b\u200b \u200b\u9ed8\u8ba4\u503c\u200b \u200b\u8bf4\u660e\u200b <code>flush_threshold</code> int 1000 \u200b\u81ea\u52a8\u200b\u5237\u65b0\u200b\u524d\u200b\u7684\u200b\u8bb0\u5f55\u200b\u6570"},{"location":"zh/quickstart/#persisting_1","title":"Persisting \u200b\u540e\u200b\u7aef\u200b\u9009\u9879","text":"\u9009\u9879\u200b \u200b\u7c7b\u578b\u200b \u200b\u9ed8\u8ba4\u503c\u200b \u200b\u8bf4\u660e\u200b <code>enable_wal</code> bool False \u200b\u542f\u7528\u200b Write-Ahead Log <code>compression</code> str None \u200b\u538b\u7f29\u7b97\u6cd5\u200b <code>enable_metrics</code> bool False \u200b\u542f\u7528\u200b Prometheus \u200b\u6307\u6807"},{"location":"zh/quickstart/#_6","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u7528\u6237\u200b\u6307\u5357\u200b - \u200b\u4e86\u89e3\u200b\u66f4\u200b\u591a\u200b\u5173\u4e8e\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b</li> <li>Lance \u200b\u540e\u200b\u7aef\u200b - Lance \u200b\u540e\u200b\u7aef\u200b\u8be6\u60c5\u200b</li> <li>Persisting \u200b\u540e\u200b\u7aef\u200b - \u200b\u589e\u5f3a\u200b\u540e\u200b\u7aef\u200b\u529f\u80fd\u200b</li> <li>API \u200b\u53c2\u8003\u200b - \u200b\u8be6\u7ec6\u200b API \u200b\u6587\u6863\u200b</li> </ul>"},{"location":"zh/design/","title":"\u8bbe\u8ba1\u200b\u6587\u6863","text":"<p>\u200b\u672c\u200b\u8282\u200b\u5305\u542b\u200b\u63cf\u8ff0\u200b Persisting \u200b\u67b6\u6784\u200b\u548c\u200b\u5b9e\u73b0\u200b\u7ec6\u8282\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u6587\u6863\u200b\u3002</p>"},{"location":"zh/design/#_2","title":"\u6982\u8ff0","text":"<p>Persisting \u200b\u88ab\u200b\u8bbe\u8ba1\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u6a21\u5757\u5316\u200b\u7684\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u7cfb\u7edf\u200b\uff0c\u200b\u4e0e\u200b Pulsing \u200b\u7684\u200b\u5206\u5e03\u5f0f\u200b\u961f\u5217\u200b\u57fa\u7840\u8bbe\u65bd\u200b\u96c6\u6210\u200b\u3002\u200b\u5173\u952e\u200b\u8bbe\u8ba1\u200b\u539f\u5219\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>\u200b\u53ef\u200b\u63d2\u62d4\u200b\u67b6\u6784\u200b - \u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u200b\u66f4\u6539\u200b\u5e94\u7528\u200b\u4ee3\u7801\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5207\u6362\u200b</li> <li>Pulsing \u200b\u96c6\u6210\u200b - \u200b\u4e0e\u200b Pulsing Actor \u200b\u6846\u67b6\u200b\u65e0\u7f1d\u200b\u96c6\u6210\u200b</li> <li>\u200b\u751f\u4ea7\u200b\u5c31\u7eea\u200b - \u200b\u4f01\u4e1a\u7ea7\u200b\u529f\u80fd\u200b\u5982\u200b WAL\u3001\u200b\u76d1\u63a7\u200b\u548c\u200b Schema \u200b\u6f14\u8fdb\u200b</li> </ul>"},{"location":"zh/design/#_3","title":"\u67b6\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          \u200b\u5e94\u7528\u5c42\u200b                                  \u2502\n\u2502                                                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502    \u2502 QueueWriter \u2502     \u2502 QueueReader \u2502     \u2502   Queue     \u2502    \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502           \u2502                   \u2502                   \u2502            \u2502\n\u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                               \u2502                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Pulsing \u200b\u5c42\u200b                              \u2502\n\u2502                               \u2502                                 \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502              \u2502        StorageManager          \u2502                \u2502\n\u2502              \u2502      (\u200b\u6bcf\u200b\u8282\u70b9\u200b\u4e00\u4e2a\u200b Actor)         \u2502                \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                               \u2502                                 \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502         \u2502                     \u2502                     \u2502          \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502    \u2502 Bucket 0 \u2502         \u2502 Bucket 1 \u2502         \u2502 Bucket N \u2502     \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2502                    \u2502                    \u2502            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                    \u2502                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u2502               \u200b\u540e\u7aef\u5c42\u200b                    \u2502            \u2502\n\u2502         \u2502                    \u2502                    \u2502            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502    \u2502 Backend  \u2502         \u2502 Backend  \u2502         \u2502 Backend  \u2502     \u2502\n\u2502    \u2502(Memory/  \u2502         \u2502(Lance/   \u2502         \u2502(Custom)  \u2502     \u2502\n\u2502    \u2502 Lance)   \u2502         \u2502Persisting\u2502         \u2502          \u2502     \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2502                    \u2502                    \u2502            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                    \u2502                    \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         \u2502               \u200b\u5b58\u50a8\u200b\u5c42\u200b                    \u2502            \u2502\n\u2502         \u25bc                    \u25bc                    \u25bc            \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502    \u2502  \u200b\u5185\u5b58\u200b   \u2502          \u2502  Lance  \u2502          \u2502  \u200b\u81ea\u5b9a\u4e49\u200b  \u2502      \u2502\n\u2502    \u2502         \u2502          \u2502  \u200b\u6587\u4ef6\u200b   \u2502          \u2502  \u200b\u5b58\u50a8\u200b   \u2502      \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502                                                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"zh/design/#_4","title":"\u6587\u6863","text":"<ul> <li>\u200b\u67b6\u6784\u8bbe\u8ba1\u200b - \u200b\u6574\u4f53\u200b\u7cfb\u7edf\u200b\u67b6\u6784\u200b</li> <li>Write-Ahead Log - WAL \u200b\u8bbe\u8ba1\u200b\u4e0e\u200b\u5b9e\u73b0\u200b</li> </ul>"},{"location":"zh/design/#_5","title":"\u8bbe\u8ba1\u200b\u539f\u5219","text":""},{"location":"zh/design/#1","title":"1. \u200b\u5173\u6ce8\u70b9\u200b\u5206\u79bb","text":"<p>\u200b\u6bcf\u5c42\u200b\u6709\u200b\u660e\u786e\u200b\u7684\u200b\u804c\u8d23\u200b\uff1a</p> <ul> <li>\u200b\u5e94\u7528\u5c42\u200b\uff1a\u200b\u9ad8\u7ea7\u200b\u961f\u5217\u200b API</li> <li>Pulsing \u200b\u5c42\u200b\uff1a\u200b\u5206\u5e03\u5f0f\u200b Actor \u200b\u7ba1\u7406\u200b</li> <li>\u200b\u540e\u7aef\u5c42\u200b\uff1a\u200b\u5b58\u50a8\u200b\u62bd\u8c61\u200b</li> <li>\u200b\u5b58\u50a8\u200b\u5c42\u200b\uff1a\u200b\u5b9e\u9645\u200b\u6570\u636e\u200b\u6301\u4e45\u200b\u5316\u200b</li> </ul>"},{"location":"zh/design/#2","title":"2. \u200b\u57fa\u4e8e\u200b\u534f\u8bae\u200b\u7684\u200b\u62bd\u8c61","text":"<p><code>StorageBackend</code> \u200b\u534f\u8bae\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u6e05\u6670\u200b\u7684\u200b\u5951\u7ea6\u200b\uff1a</p> <pre><code>class StorageBackend(Protocol):\n    async def put(self, record: dict[str, Any]) -&gt; None: ...\n    async def get(self, offset: int, limit: int) -&gt; list[dict]: ...\n    async def flush(self) -&gt; None: ...\n    # ...\n</code></pre>"},{"location":"zh/design/#3","title":"3. \u200b\u7ec4\u5408\u200b\u4f18\u4e8e\u200b\u7ee7\u627f","text":"<p>\u200b\u540e\u7aef\u200b\u88ab\u200b\u7ec4\u5408\u200b\u5230\u200b <code>BucketStorage</code> Actor \u200b\u4e2d\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4ece\u200b\u57fa\u7c7b\u200b\u7ee7\u627f\u200b\u3002</p>"},{"location":"zh/design/#4","title":"4. \u200b\u5b89\u5168\u200b\u7684\u200b\u9ed8\u8ba4\u503c","text":"<ul> <li>\u200b\u6d4b\u8bd5\u200b\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u540e\u200b\u7aef\u200b\uff08\u200b\u65e0\u200b\u5916\u90e8\u200b\u4f9d\u8d56\u200b\uff09</li> <li>\u200b\u5408\u7406\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u914d\u7f6e\u200b</li> <li>\u200b\u4f18\u96c5\u200b\u964d\u7ea7\u200b</li> </ul>"},{"location":"zh/design/#_6","title":"\u540e\u7eed\u200b\u5de5\u4f5c","text":"<ul> <li>[ ] \u200b\u591a\u200b\u533a\u57df\u200b\u590d\u5236\u200b</li> <li>[ ] \u200b\u5206\u5c42\u200b\u5b58\u50a8\u200b\uff08\u200b\u70ed\u200b/\u200b\u51b7\u200b\uff09</li> <li>[ ] \u200b\u67e5\u8be2\u200b\u4f18\u5316\u200b</li> <li>[ ] \u200b\u5907\u4efd\u200b\u548c\u200b\u6062\u590d\u200b\u5de5\u5177\u200b</li> </ul>"},{"location":"zh/design/architecture/","title":"\u67b6\u6784\u8bbe\u8ba1","text":"<p>\u200b\u672c\u200b\u6587\u6863\u200b\u63cf\u8ff0\u200b Persisting \u200b\u7684\u200b\u6574\u4f53\u200b\u67b6\u6784\u200b\u3002</p>"},{"location":"zh/design/architecture/#_2","title":"\u7cfb\u7edf\u200b\u7ec4\u4ef6","text":""},{"location":"zh/design/architecture/#1-storagebackend","title":"1. StorageBackend \u200b\u534f\u8bae","text":"<p>\u200b\u6240\u6709\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b\u7684\u200b\u6838\u5fc3\u200b\u62bd\u8c61\u200b\uff1a</p> <pre><code>class StorageBackend(Protocol):\n    \"\"\"\u200b\u53ef\u200b\u63d2\u62d4\u200b\u6301\u4e45\u200b\u5316\u200b\u7684\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u534f\u8bae\u200b\u3002\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"\u200b\u5b58\u50a8\u200b\u5355\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"\u200b\u9ad8\u6548\u200b\u5b58\u50a8\u200b\u591a\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n\n    async def get(self, offset: int, limit: int | None) -&gt; list[dict]:\n        \"\"\"\u200b\u4ece\u200b\u504f\u79fb\u91cf\u200b\u68c0\u7d22\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n\n    async def get_stream(\n        self, offset: int, limit: int | None, block: bool\n    ) -&gt; AsyncIterator[dict]:\n        \"\"\"\u200b\u6d41\u5f0f\u200b\u8bfb\u53d6\u200b\u8bb0\u5f55\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u963b\u585e\u200b\u7b49\u5f85\u200b\u65b0\u200b\u6570\u636e\u200b\u3002\"\"\"\n\n    async def flush(self) -&gt; None:\n        \"\"\"\u200b\u5c06\u200b\u7f13\u51b2\u200b\u6570\u636e\u200b\u6301\u4e45\u200b\u5316\u5230\u200b\u5b58\u50a8\u200b\u3002\"\"\"\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"\u200b\u8fd4\u56de\u200b\u5b58\u50a8\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u3002\"\"\"\n\n    def total_count(self) -&gt; int:\n        \"\"\"\u200b\u8fd4\u56de\u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b\u3002\"\"\"\n</code></pre>"},{"location":"zh/design/architecture/#2-lancebackend","title":"2. LanceBackend","text":"<p>\u200b\u4f7f\u7528\u200b Lance \u200b\u5217\u5f0f\u200b\u683c\u5f0f\u200b\u7684\u200b\u9ad8\u6027\u80fd\u200b\u5b58\u50a8\u200b\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             LanceBackend                \u2502\n\u2502                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502          \u200b\u5185\u5b58\u200b\u7f13\u51b2\u533a\u200b              \u2502   \u2502\n\u2502  \u2502    (\u200b\u7b49\u5f85\u200b\u5237\u65b0\u200b\u7684\u200b\u8bb0\u5f55\u200b)              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                 \u2502                       \u2502\n\u2502                 \u25bc flush()               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502        Lance Dataset            \u2502   \u2502\n\u2502  \u2502    (\u200b\u78c1\u76d8\u200b\u4e0a\u200b\u7684\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b)            \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u200b\u7279\u6027\u200b\uff1a - \u200b\u5185\u5b58\u200b\u7f13\u51b2\u200b\u7528\u4e8e\u200b\u5199\u200b\u5408\u5e76\u200b - \u200b\u81ea\u52a8\u200b Schema \u200b\u63a8\u65ad\u200b - \u200b\u5185\u7f6e\u200b\u7248\u672c\u63a7\u5236\u200b - \u200b\u9ad8\u6027\u80fd\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b</p>"},{"location":"zh/design/architecture/#3-persistingbackend","title":"3. PersistingBackend","text":"<p>\u200b\u5e26\u200b\u4f01\u4e1a\u7ea7\u200b\u529f\u80fd\u200b\u7684\u200b\u589e\u5f3a\u200b\u540e\u200b\u7aef\u200b\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   PersistingBackend                      \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                  WAL \u200b\u5c42\u200b                          \u2502   \u2502\n\u2502  \u2502          (\u200b\u7528\u4e8e\u200b\u6301\u4e45\u6027\u200b\u7684\u200b\u9884\u5199\u200b\u65e5\u5fd7\u200b)                   \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                         \u2502                               \u2502\n\u2502                         \u25bc                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                \u200b\u5185\u5b58\u200b\u7f13\u51b2\u533a\u200b                        \u2502   \u2502\n\u2502  \u2502            (\u200b\u652f\u6301\u200b\u538b\u7f29\u200b)                           \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                         \u2502                               \u2502\n\u2502                         \u25bc flush()                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502              Lance Dataset                       \u2502   \u2502\n\u2502  \u2502          (\u200b\u652f\u6301\u200b Schema \u200b\u6f14\u8fdb\u200b)                      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502              \u200b\u6307\u6807\u200b\u6536\u96c6\u5668\u200b                          \u2502   \u2502\n\u2502  \u2502        (Prometheus \u200b\u6307\u6807\u200b\u5bfc\u51fa\u200b)                    \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u200b\u7279\u6027\u200b\uff1a - \u200b\u6240\u6709\u200b LanceBackend \u200b\u529f\u80fd\u200b - \u200b\u7528\u4e8e\u200b\u5d29\u6e83\u200b\u6062\u590d\u200b\u7684\u200b\u9884\u5199\u200b\u65e5\u5fd7\u200b - Schema \u200b\u6f14\u8fdb\u200b\u652f\u6301\u200b - \u200b\u538b\u7f29\u200b\u9009\u9879\u200b - Prometheus \u200b\u6307\u6807\u200b</p>"},{"location":"zh/design/architecture/#_3","title":"\u6570\u636e\u6d41","text":""},{"location":"zh/design/architecture/#_4","title":"\u5199\u5165\u200b\u8def\u5f84","text":"<pre><code>\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\n    \u2502\n    \u25bc put(record)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  QueueWriter    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc \u200b\u6309\u200b bucket_column \u200b\u8def\u7531\u200b\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 StorageManager  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc \u200b\u53d1\u9001\u5230\u200b bucket \u200b\u6240\u6709\u8005\u200b\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 BucketStorage   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc \u200b\u59d4\u6258\u200b\u7ed9\u200b\u540e\u200b\u7aef\u200b\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 StorageBackend  \u2502\u2500\u2500\u25ba WAL (\u200b\u5982\u679c\u200b\u542f\u7528\u200b)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc \u200b\u7f13\u51b2\u200b\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   \u200b\u5185\u5b58\u200b\u7f13\u51b2\u533a\u200b     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc \u200b\u8fbe\u5230\u200b\u9608\u503c\u200b\u65f6\u200b flush()\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Lance Dataset  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"zh/design/architecture/#_5","title":"\u8bfb\u53d6\u200b\u8def\u5f84","text":"<pre><code>\u200b\u5e94\u7528\u7a0b\u5e8f\u200b\n    \u2502\n    \u25bc get(offset, limit)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  QueueReader    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 StorageManager  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc \u200b\u67e5\u8be2\u200b\u6bcf\u4e2a\u200b bucket\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      BucketStorage (\u200b\u5e76\u884c\u200b)           \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502 B0  \u2502  \u2502 B1  \u2502  \u2502 BN  \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u252c\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2518  \u2514\u2500\u2500\u252c\u2500\u2500\u2518       \u2502\n\u2502      \u2502        \u2502        \u2502           \u2502\n\u2502      \u25bc        \u25bc        \u25bc           \u2502\n\u2502   StorageBackend.get()             \u2502\n\u2502      \u2502        \u2502        \u2502           \u2502\n\u2502      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n\u2502               \u2502                     \u2502\n\u2502               \u25bc                     \u2502\n\u2502          \u200b\u5408\u5e76\u200b\u7ed3\u679c\u200b                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n    \u200b\u5e94\u7528\u7a0b\u5e8f\u200b\n</code></pre>"},{"location":"zh/design/architecture/#bucket","title":"Bucket \u200b\u5206\u5e03","text":"<p>\u200b\u8bb0\u5f55\u200b\u901a\u8fc7\u200b\u4e00\u81f4\u6027\u200b\u54c8\u5e0c\u200b\u5206\u5e03\u200b\u5230\u200b\u5404\u200b bucket\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Bucket \u200b\u73af\u200b                             \u2502\n\u2502                                                          \u2502\n\u2502                       \u200b\u8282\u70b9\u200b A                             \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2502 Bucket 0\u2502\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502              \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502                    \u2502\n\u2502              \u2502                     \u2502                    \u2502\n\u2502        \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502   \u200b\u8282\u70b9\u200b C\u2502Bucket 3\u2502           \u2502Bucket 1 \u2502\u200b\u8282\u70b9\u200b B          \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2502              \u2502                    \u2502                     \u2502\n\u2502              \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502                     \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2502 Bucket 2\u2502\u2500\u2500\u2500\u2500\u2518                     \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502\n\u2502                       \u200b\u8282\u70b9\u200b B                             \u2502\n\u2502                                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u200b\u8bb0\u5f55\u200b\u8def\u7531\u200b:\n  hash(record[bucket_column]) % num_buckets \u2192 bucket_id\n  bucket_id \u2192 owner_node (\u200b\u901a\u8fc7\u200b\u4e00\u81f4\u6027\u200b\u54c8\u5e0c\u200b)\n</code></pre>"},{"location":"zh/design/architecture/#_6","title":"\u5e76\u53d1\u200b\u6a21\u578b","text":""},{"location":"zh/design/architecture/#_7","title":"\u7ebf\u7a0b\u200b\u5b89\u5168","text":"<p>\u200b\u6240\u6709\u200b\u540e\u200b\u7aef\u200b\u4f7f\u7528\u200b <code>asyncio.Condition</code> \u200b\u5b9e\u73b0\u200b\u5b89\u5168\u200b\u7684\u200b\u5e76\u53d1\u200b\u8bbf\u95ee\u200b\uff1a</p> <pre><code>class Backend:\n    def __init__(self):\n        self._condition = asyncio.Condition()\n\n    async def put(self, record):\n        async with self._condition:\n            self._buffer.append(record)\n            self._condition.notify_all()  # \u200b\u5524\u9192\u200b\u8bfb\u53d6\u200b\u8005\u200b\n\n    async def get_stream(self, block=False):\n        async with self._condition:\n            while no_data_available:\n                if not block:\n                    return\n                await self._condition.wait()  # \u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\n</code></pre>"},{"location":"zh/design/architecture/#_8","title":"\u963b\u585e\u200b\u8bfb\u53d6","text":"<p><code>get_stream(block=True)</code> \u200b\u6a21\u5f0f\u200b\u652f\u6301\u200b\u6d88\u8d39\u8005\u200b\u963b\u585e\u200b\uff1a</p> <pre><code>async for record in reader.get_stream(block=True):\n    # \u200b\u8ffd\u200b\u4e0a\u200b\u65f6\u4f1a\u200b\u7b49\u5f85\u200b\u65b0\u200b\u8bb0\u5f55\u200b\n    process(record)\n</code></pre>"},{"location":"zh/design/architecture/#_9","title":"\u914d\u7f6e","text":""},{"location":"zh/design/architecture/#_10","title":"\u540e\u200b\u7aef\u200b\u9009\u62e9","text":"<pre><code># \u200b\u6309\u200b\u540d\u79f0\u200b\uff08\u200b\u5fc5\u987b\u200b\u5df2\u200b\u6ce8\u518c\u200b\uff09\nwriter = await write_queue(system, topic, backend=\"lance\")\n\n# \u200b\u6309\u7c7b\u200b\uff08\u200b\u81ea\u52a8\u200b\u6ce8\u518c\u200b\uff09\nwriter = await write_queue(system, topic, backend=LanceBackend)\n</code></pre>"},{"location":"zh/design/architecture/#_11","title":"\u540e\u200b\u7aef\u200b\u9009\u9879","text":"<p>\u200b\u9009\u9879\u200b\u4f20\u9012\u200b\u7ed9\u200b\u540e\u200b\u7aef\u200b\u6784\u9020\u51fd\u6570\u200b\uff1a</p> <pre><code>writer = await write_queue(\n    system, topic,\n    backend=\"persisting\",\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n    },\n)\n</code></pre>"},{"location":"zh/design/architecture/#_12","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"zh/design/architecture/#_13","title":"\u5199\u5165\u200b\u5931\u8d25","text":"<pre><code>try:\n    await writer.put(record)\nexcept StorageError as e:\n    # \u200b\u5904\u7406\u200b\u5b58\u50a8\u200b\u5931\u8d25\u200b\n    logger.error(f\"\u200b\u5199\u5165\u200b\u5931\u8d25\u200b: {e}\")\n</code></pre>"},{"location":"zh/design/architecture/#_14","title":"\u6062\u590d","text":"<p>\u200b\u542f\u7528\u200b WAL \u200b\u540e\u200b\uff0c\u200b\u672a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6570\u636e\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\u6062\u590d\u200b\uff1a</p> <pre><code>\u200b\u542f\u52a8\u200b\n    \u2502\n    \u25bc\n\u200b\u68c0\u67e5\u200b WAL \u200b\u6587\u4ef6\u200b\n    \u2502\n    \u251c\u2500\u25ba \u200b\u65e0\u200b WAL: \u200b\u6b63\u5e38\u200b\u542f\u52a8\u200b\n    \u2502\n    \u2514\u2500\u25ba WAL \u200b\u5b58\u5728\u200b: \u200b\u91cd\u653e\u672a\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55\u200b\n            \u2502\n            \u25bc\n        \u200b\u5e94\u7528\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\n            \u2502\n            \u25bc\n        \u200b\u7ee7\u7eed\u200b\u6b63\u5e38\u200b\u64cd\u4f5c\u200b\n</code></pre>"},{"location":"zh/design/architecture/#_15","title":"\u672a\u6765\u200b\u8003\u8651","text":"<ol> <li>\u200b\u591a\u200b\u533a\u57df\u200b\u590d\u5236\u200b - \u200b\u8de8\u200b\u6570\u636e\u4e2d\u5fc3\u200b\u6570\u636e\u200b\u540c\u6b65\u200b</li> <li>\u200b\u5206\u5c42\u200b\u5b58\u50a8\u200b - \u200b\u70ed\u200b/\u200b\u51b7\u200b\u6570\u636e\u7ba1\u7406\u200b</li> <li>\u200b\u67e5\u8be2\u200b\u4e0b\u63a8\u200b - \u200b\u5b58\u50a8\u200b\u5c42\u200b\u8fc7\u6ee4\u200b\u8ba1\u7b97\u200b</li> <li>\u200b\u5907\u4efd\u200b/\u200b\u6062\u590d\u200b - \u200b\u65f6\u95f4\u200b\u70b9\u200b\u6062\u590d\u200b</li> </ol>"},{"location":"zh/design/wal/","title":"Write-Ahead Log (WAL)","text":"<p>\u200b\u672c\u200b\u6587\u6863\u200b\u63cf\u8ff0\u200b Persisting \u200b\u4e2d\u200b\u7684\u200b Write-Ahead Log \u200b\u8bbe\u8ba1\u200b\u3002</p>"},{"location":"zh/design/wal/#_1","title":"\u6982\u8ff0","text":"<p>Write-Ahead Log (WAL) \u200b\u901a\u8fc7\u200b\u5728\u200b\u66f4\u6539\u200b\u5e94\u7528\u200b\u5230\u200b\u4e3b\u200b\u5b58\u50a8\u200b\u4e4b\u524d\u200b\u8bb0\u5f55\u200b\u5b83\u4eec\u200b\u6765\u200b\u786e\u4fdd\u200b\u6570\u636e\u200b\u6301\u4e45\u6027\u200b\u3002\u200b\u8fd9\u200b\u5141\u8bb8\u200b\u5728\u200b\u5d29\u6e83\u200b\u540e\u200b\u6062\u590d\u200b\u672a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"zh/design/wal/#_2","title":"\u8bbe\u8ba1\u200b\u76ee\u6807","text":"<ol> <li>\u200b\u6301\u4e45\u6027\u200b - \u200b\u786e\u8ba4\u200b\u5199\u5165\u200b\u540e\u200b\u65e0\u200b\u6570\u636e\u200b\u4e22\u5931\u200b</li> <li>\u200b\u6027\u80fd\u200b - \u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\u7684\u200b\u6700\u5c0f\u200b\u5f00\u9500\u200b</li> <li>\u200b\u6062\u590d\u200b - \u200b\u5feb\u901f\u200b\u4e14\u200b\u6b63\u786e\u200b\u7684\u200b\u5d29\u6e83\u200b\u6062\u590d\u200b</li> <li>\u200b\u7b80\u5355\u200b\u6027\u200b - \u200b\u6613\u4e8e\u200b\u7406\u89e3\u200b\u548c\u200b\u7ef4\u62a4\u200b</li> </ol>"},{"location":"zh/design/wal/#_3","title":"\u67b6\u6784","text":"<pre><code>\u200b\u5199\u5165\u200b\u8bf7\u6c42\u200b\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            WAL Writer                   \u2502\n\u2502                                         \u2502\n\u2502  1. \u200b\u5c06\u200b\u8bb0\u5f55\u200b\u5e8f\u5217\u5316\u200b\u4e3a\u200b\u5b57\u8282\u200b                    \u2502\n\u2502  2. \u200b\u5199\u5165\u200b\u957f\u5ea6\u200b + \u200b\u6821\u9a8c\u200b\u548c\u200b + \u200b\u6570\u636e\u200b              \u2502\n\u2502  3. fsync() (\u200b\u5982\u679c\u200b\u662f\u200b\u540c\u6b65\u200b\u6a21\u5f0f\u200b)              \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            WAL \u200b\u6587\u4ef6\u200b                     \u2502\n\u2502                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 \u200b\u8bb0\u5f55\u200b 1: [len][crc][data]        \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 \u200b\u8bb0\u5f55\u200b 2: [len][crc][data]        \u2502   \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524   \u2502\n\u2502  \u2502 \u200b\u8bb0\u5f55\u200b 3: [len][crc][data]        \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           \u200b\u5185\u5b58\u200b\u7f13\u51b2\u533a\u200b                     \u2502\n\u2502                                         \u2502\n\u2502  (\u200b\u6279\u91cf\u200b\u5237\u65b0\u200b\u7684\u200b\u7f13\u51b2\u200b\u8bb0\u5f55\u200b)                    \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc flush()\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Lance Dataset                  \u2502\n\u2502                                         \u2502\n\u2502  (\u200b\u6301\u4e45\u200b\u5316\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b)                        \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          \u200b\u622a\u65ad\u200b WAL                       \u2502\n\u2502                                         \u2502\n\u2502  (\u200b\u5220\u9664\u200b\u5df2\u200b\u63d0\u4ea4\u200b\u8bb0\u5f55\u200b)                        \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"zh/design/wal/#_4","title":"\u8bb0\u5f55\u200b\u683c\u5f0f","text":"<p>\u200b\u6bcf\u4e2a\u200b WAL \u200b\u8bb0\u5f55\u200b\u5177\u6709\u200b\u4ee5\u4e0b\u200b\u683c\u5f0f\u200b\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   \u200b\u957f\u5ea6\u200b     \u2502   \u200b\u6821\u9a8c\u200b\u548c\u200b   \u2502       \u200b\u6570\u636e\u200b         \u2502\n\u2502  (4 \u200b\u5b57\u8282\u200b)  \u2502  (4 \u200b\u5b57\u8282\u200b)  \u2502    (\u200b\u53ef\u53d8\u200b)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ul> <li>\u200b\u957f\u5ea6\u200b: \u200b\u8bb0\u5f55\u200b\u6570\u636e\u200b\u957f\u5ea6\u200b (uint32, \u200b\u5c0f\u7aef\u200b)</li> <li>\u200b\u6821\u9a8c\u200b\u548c\u200b: \u200b\u6570\u636e\u200b\u7684\u200b CRC32 (uint32, \u200b\u5c0f\u7aef\u200b)</li> <li>\u200b\u6570\u636e\u200b: \u200b\u5e8f\u5217\u5316\u200b\u7684\u200b\u8bb0\u5f55\u200b (JSON \u200b\u6216\u200b MessagePack)</li> </ul>"},{"location":"zh/design/wal/#_5","title":"\u5199\u5165\u200b\u8def\u5f84","text":""},{"location":"zh/design/wal/#_6","title":"\u6b63\u5e38\u200b\u5199\u5165","text":"<pre><code>async def put(self, record: dict) -&gt; None:\n    if self.enable_wal:\n        # 1. \u200b\u9996\u5148\u200b\u5199\u5165\u200b WAL\n        await self._wal.append(record)\n\n    # 2. \u200b\u6dfb\u52a0\u200b\u5230\u200b\u5185\u5b58\u200b\u7f13\u51b2\u533a\u200b\n    async with self._condition:\n        self._buffer.append(record)\n        self._condition.notify_all()\n</code></pre>"},{"location":"zh/design/wal/#_7","title":"\u540c\u6b65\u200b\u6a21\u5f0f","text":"\u6a21\u5f0f\u200b \u200b\u63cf\u8ff0\u200b \u200b\u6301\u4e45\u6027\u200b \u200b\u6027\u80fd\u200b <code>sync</code> \u200b\u6bcf\u6b21\u200b\u5199\u5165\u200b\u540e\u200b fsync \u200b\u6700\u9ad8\u200b \u200b\u6700\u6162\u200b <code>batch</code> \u200b\u5b9a\u671f\u200b fsync \u200b\u9ad8\u200b \u200b\u5feb\u200b <code>async</code> \u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u63a7\u5236\u200b\u540c\u6b65\u200b \u200b\u4f4e\u200b \u200b\u6700\u5feb\u200b <pre><code># \u200b\u6bcf\u6b21\u200b\u5199\u5165\u200b\u90fd\u200b\u540c\u6b65\u200b\uff08\u200b\u6700\u200b\u5b89\u5168\u200b\uff09\nbackend_options={\"wal_sync_interval\": 0.0}\n\n# \u200b\u6bcf\u200b 100ms \u200b\u540c\u6b65\u200b\uff08\u200b\u5e73\u8861\u200b\uff09\nbackend_options={\"wal_sync_interval\": 0.1}\n\n# \u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u63a7\u5236\u200b\uff08\u200b\u6700\u5feb\u200b\uff09\nbackend_options={\"wal_sync_interval\": 1.0}\n</code></pre>"},{"location":"zh/design/wal/#_8","title":"\u6062\u590d","text":""},{"location":"zh/design/wal/#_9","title":"\u542f\u52a8\u200b\u6062\u590d","text":"<pre><code>async def _recover(self) -&gt; None:\n    \"\"\"\u200b\u4ece\u200b WAL \u200b\u6062\u590d\u200b\u672a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n    if not self._wal_path.exists():\n        return\n\n    recovered = []\n    async for record in self._wal.read_all():\n        recovered.append(record)\n\n    if recovered:\n        logger.info(f\"\u200b\u4ece\u200b WAL \u200b\u6062\u590d\u200b\u4e86\u200b {len(recovered)} \u200b\u6761\u200b\u8bb0\u5f55\u200b\")\n        self._buffer.extend(recovered)\n</code></pre>"},{"location":"zh/design/wal/#_10","title":"\u6062\u590d\u200b\u6d41\u7a0b","text":"<pre><code>\u200b\u542f\u52a8\u200b\n    \u2502\n    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          \u200b\u68c0\u67e5\u200b WAL \u200b\u662f\u5426\u200b\u5b58\u5728\u200b               \u2502\n\u2502                                         \u2502\n\u2502  WAL \u200b\u8def\u5f84\u200b: {storage_path}/wal/          \u2502\n\u2502  WAL \u200b\u6587\u4ef6\u200b: {bucket_id}.wal              \u2502\n\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502                 \u2502\n   WAL \u200b\u5b58\u5728\u200b           \u200b\u65e0\u200b WAL\n        \u2502                 \u2502\n        \u25bc                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u200b\u8bfb\u53d6\u200b\u8bb0\u5f55\u200b      \u2502  \u2502 \u200b\u6b63\u5e38\u200b\u542f\u52a8\u200b      \u2502\n\u2502 \u200b\u9a8c\u8bc1\u200b CRC      \u2502  \u2502               \u2502\n\u2502 \u200b\u6dfb\u52a0\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b  \u2502  \u2502               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502\n        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u200b\u7ee7\u7eed\u200b\u5904\u7406\u200b      \u2502\n\u2502 \u200b\u6062\u590d\u200b\u7684\u200b\u6570\u636e\u200b    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"zh/design/wal/#_11","title":"\u635f\u574f\u200b\u5904\u7406","text":"<pre><code>async def _read_record(self, file) -&gt; dict | None:\n    \"\"\"\u200b\u8bfb\u53d6\u200b\u5e76\u200b\u9a8c\u8bc1\u200b\u5355\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n    try:\n        # \u200b\u8bfb\u53d6\u200b\u957f\u5ea6\u200b\n        length_bytes = await file.read(4)\n        if len(length_bytes) &lt; 4:\n            return None\n        length = struct.unpack('&lt;I', length_bytes)[0]\n\n        # \u200b\u8bfb\u53d6\u200b\u6821\u9a8c\u200b\u548c\u200b\n        checksum_bytes = await file.read(4)\n        checksum = struct.unpack('&lt;I', checksum_bytes)[0]\n\n        # \u200b\u8bfb\u53d6\u6570\u636e\u200b\n        data = await file.read(length)\n\n        # \u200b\u9a8c\u8bc1\u200b\u6821\u9a8c\u200b\u548c\u200b\n        if crc32(data) != checksum:\n            logger.warning(\"\u200b\u68c0\u6d4b\u200b\u5230\u200b WAL \u200b\u8bb0\u5f55\u200b\u635f\u574f\u200b\")\n            return None\n\n        return json.loads(data)\n    except Exception as e:\n        logger.error(f\"WAL \u200b\u8bfb\u53d6\u200b\u9519\u8bef\u200b: {e}\")\n        return None\n</code></pre>"},{"location":"zh/design/wal/#_12","title":"\u622a\u65ad","text":"<p>\u200b\u6210\u529f\u200b\u5237\u65b0\u200b\u540e\u200b\u622a\u65ad\u200b WAL\uff1a</p> <pre><code>async def flush(self) -&gt; None:\n    \"\"\"\u200b\u5237\u65b0\u200b\u7f13\u51b2\u533a\u200b\u5230\u200b Lance \u200b\u5e76\u200b\u622a\u65ad\u200b WAL\u3002\"\"\"\n    async with self._condition:\n        if not self._buffer:\n            return\n\n        # 1. \u200b\u5199\u5165\u200b Lance\n        await self._write_to_lance(self._buffer)\n\n        # 2. \u200b\u622a\u65ad\u200b WAL\uff08\u200b\u8bb0\u5f55\u200b\u73b0\u5728\u200b\u5df2\u200b\u6301\u4e45\u200b\u5316\u200b\uff09\n        if self.enable_wal:\n            await self._wal.truncate()\n\n        # 3. \u200b\u6e05\u7a7a\u200b\u7f13\u51b2\u533a\u200b\n        self._buffer.clear()\n</code></pre>"},{"location":"zh/design/wal/#_13","title":"\u6587\u4ef6\u200b\u7ba1\u7406","text":""},{"location":"zh/design/wal/#wal","title":"WAL \u200b\u76ee\u5f55\u200b\u7ed3\u6784","text":"<pre><code>{storage_path}/\n\u2514\u2500\u2500 {topic}/\n    \u2514\u2500\u2500 bucket_{id}/\n        \u251c\u2500\u2500 data.lance/          # Lance \u200b\u6570\u636e\u200b\u96c6\u200b\n        \u2514\u2500\u2500 wal/\n            \u251c\u2500\u2500 0.wal           # \u200b\u5f53\u524d\u200b WAL \u200b\u6587\u4ef6\u200b\n            \u2514\u2500\u2500 0.wal.tmp       # \u200b\u8f6e\u8f6c\u200b\u65f6\u200b\u7684\u200b\u4e34\u65f6\u6587\u4ef6\u200b\n</code></pre>"},{"location":"zh/design/wal/#wal_1","title":"WAL \u200b\u8f6e\u8f6c","text":"<p>\u200b\u5f53\u200b WAL \u200b\u8d85\u8fc7\u200b <code>max_wal_size</code> \u200b\u65f6\u200b\uff1a</p> <pre><code>async def _maybe_rotate(self) -&gt; None:\n    \"\"\"\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u6700\u5927\u200b\u5927\u5c0f\u200b\u5219\u200b\u8f6e\u8f6c\u200b WAL\u3002\"\"\"\n    if self._wal_size &gt; self.max_wal_size:\n        # 1. \u200b\u5f3a\u5236\u200b\u5237\u65b0\u200b\u5230\u200b Lance\n        await self.flush()\n\n        # 2. \u200b\u521b\u5efa\u200b\u65b0\u200b WAL \u200b\u6587\u4ef6\u200b\n        await self._wal.rotate()\n\n        self._wal_size = 0\n</code></pre>"},{"location":"zh/design/wal/#_14","title":"\u914d\u7f6e","text":"\u9009\u9879\u200b \u200b\u7c7b\u578b\u200b \u200b\u9ed8\u8ba4\u503c\u200b \u200b\u63cf\u8ff0\u200b <code>enable_wal</code> bool False \u200b\u542f\u7528\u200b WAL <code>wal_sync_interval</code> float 1.0 \u200b\u540c\u6b65\u200b\u95f4\u9694\u200b (0=\u200b\u6bcf\u6b21\u200b\u5199\u5165\u200b) <code>max_wal_size</code> int 100MB \u200b\u8f6e\u8f6c\u200b\u524d\u200b\u7684\u200b\u6700\u5927\u200b WAL \u200b\u5927\u5c0f"},{"location":"zh/design/wal/#_15","title":"\u6027\u80fd\u200b\u8003\u8651","text":""},{"location":"zh/design/wal/#_16","title":"\u5199\u200b\u653e\u5927","text":"<p>\u200b\u6bcf\u6b21\u200b\u5199\u5165\u200b\u90fd\u200b\u4f1a\u200b\u5199\u5165\u200b WAL \u200b\u548c\u200b\u7f13\u51b2\u533a\u200b\uff1a - WAL: \u200b\u987a\u5e8f\u200b\u8ffd\u52a0\u200b\uff08\u200b\u5feb\u200b\uff09 - \u200b\u7f13\u51b2\u533a\u200b: \u200b\u5185\u5b58\u200b\u4e2d\u200b\uff08\u200b\u5feb\u200b\uff09 - Lance: \u200b\u5237\u65b0\u200b\u65f6\u200b\u6279\u91cf\u200b\u5199\u5165\u200b\uff08\u200b\u9ad8\u6548\u200b\uff09</p>"},{"location":"zh/design/wal/#_17","title":"\u540c\u6b65\u200b\u6743\u8861","text":"<pre><code>                    \u200b\u6301\u4e45\u6027\u200b\n                        \u25b2\n                        \u2502\n        sync \u200b\u6a21\u5f0f\u200b \u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                        \u2502\n       batch \u200b\u6a21\u5f0f\u200b \u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                        \u2502\n        async \u200b\u6a21\u5f0f\u200b \u2500\u2500\u2500\u2500\u2500\u2524\n                        \u2502\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u200b\u6027\u80fd\u200b\n</code></pre>"},{"location":"zh/design/wal/#_18","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":"<ol> <li>\u200b\u751f\u4ea7\u200b\u4f7f\u7528\u200b batch \u200b\u540c\u6b65\u200b: \u200b\u5e73\u8861\u200b\u6301\u4e45\u6027\u200b\u548c\u200b\u6027\u80fd\u200b</li> <li>\u200b\u9002\u5f53\u200b\u8c03\u6574\u200b WAL \u200b\u5927\u5c0f\u200b: \u200b\u592a\u5c0f\u200b = \u200b\u9891\u7e41\u200b\u8f6e\u8f6c\u200b\uff0c\u200b\u592a\u200b\u5927\u200b = \u200b\u6062\u590d\u200b\u6162\u200b</li> <li>\u200b\u76d1\u63a7\u200b WAL \u200b\u5927\u5c0f\u200b: \u200b\u5bf9\u200b\u610f\u5916\u200b\u589e\u957f\u200b\u53d1\u51fa\u200b\u8b66\u62a5\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\u6062\u590d\u200b: \u200b\u5b9a\u671f\u200b\u9a8c\u8bc1\u200b\u6062\u590d\u200b\u529f\u80fd\u200b</li> </ol>"},{"location":"zh/design/wal/#_19","title":"\u9650\u5236","text":"<ol> <li>\u200b\u5355\u200b\u5199\u5165\u200b\u8005\u200b\u5047\u8bbe\u200b: WAL \u200b\u5047\u8bbe\u200b\u6bcf\u4e2a\u200b bucket \u200b\u4e00\u4e2a\u200b\u5199\u5165\u200b\u8005\u200b</li> <li>\u200b\u6709\u5e8f\u200b\u6062\u590d\u200b: \u200b\u8bb0\u5f55\u200b\u6309\u200b\u5199\u5165\u200b\u987a\u5e8f\u200b\u6062\u590d\u200b</li> <li>\u200b\u65e0\u200b\u90e8\u5206\u200b\u8bb0\u5f55\u200b\u6062\u590d\u200b: \u200b\u8df3\u8fc7\u200b\u635f\u574f\u200b\u7684\u200b\u8bb0\u5f55\u200b</li> </ol>"},{"location":"zh/design/wal/#_20","title":"\u672a\u6765\u200b\u6539\u8fdb","text":"<ol> <li>\u200b\u538b\u7f29\u200b: \u200b\u538b\u7f29\u200b WAL \u200b\u8bb0\u5f55\u200b</li> <li>\u200b\u5f02\u6b65\u200b I/O: \u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u4f7f\u7528\u200b io_uring</li> <li>\u200b\u7ec4\u200b\u63d0\u4ea4\u200b: \u200b\u8de8\u200b\u591a\u4e2a\u200b\u5199\u5165\u200b\u6279\u91cf\u200b\u540c\u6b65\u200b</li> <li>\u200b\u6821\u9a8c\u200b\u548c\u200b\u5757\u200b: \u200b\u66f4\u597d\u200b\u5730\u200b\u5904\u7406\u200b\u90e8\u5206\u200b\u5199\u5165\u200b</li> </ol>"},{"location":"zh/guide/","title":"\u7528\u6237\u200b\u6307\u5357","text":"<p>\u200b\u6b22\u8fce\u200b\u9605\u8bfb\u200b Persisting \u200b\u7528\u6237\u200b\u6307\u5357\u200b\u3002\u200b\u672c\u200b\u6307\u5357\u200b\u6db5\u76d6\u200b\u6838\u5fc3\u200b\u6982\u5ff5\u200b\u548c\u200b\u4f7f\u7528\u200b\u6a21\u5f0f\u200b\u3002</p>"},{"location":"zh/guide/#_2","title":"\u6982\u8ff0","text":"<p>Persisting \u200b\u4e3a\u200b Pulsing \u200b\u7684\u200b\u5206\u5e03\u5f0f\u200b\u961f\u5217\u200b\u7cfb\u7edf\u200b\u63d0\u4f9b\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002\u200b\u5b83\u200b\u652f\u6301\u200b\u53ef\u9760\u200b\u7684\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b\uff0c\u200b\u5177\u6709\u200b\u4ee5\u4e0b\u200b\u7279\u6027\u200b\uff1a</p> <ul> <li>\u200b\u57fa\u4e8e\u200b Lance \u200b\u7684\u200b\u6301\u4e45\u200b\u5316\u200b - \u200b\u9ad8\u6027\u80fd\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b</li> <li>Write-Ahead Log (WAL) - \u200b\u6570\u636e\u200b\u6301\u4e45\u6027\u200b\u4fdd\u8bc1\u200b</li> <li>Schema \u200b\u6f14\u8fdb\u200b - \u200b\u7075\u6d3b\u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\u53d8\u66f4\u200b</li> <li>\u200b\u76d1\u63a7\u200b - \u200b\u5185\u7f6e\u200b\u6307\u6807\u200b\u548c\u200b\u53ef\u200b\u89c2\u6d4b\u200b\u6027\u200b</li> </ul>"},{"location":"zh/guide/#_3","title":"\u67b6\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Pulsing \u200b\u961f\u5217\u200b                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 QueueWriter \u2502  \u2502 QueueReader \u2502  \u2502   Queue     \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2502                \u2502                \u2502             \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n\u2502                          \u25bc                              \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502              \u2502   StorageManager      \u2502                  \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                          \u25bc                              \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502              \u2502   BucketStorage       \u2502                  \u2502\n\u2502              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                          \u2502                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  StorageBackend \u200b\u534f\u8bae\u200b                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502MemoryBackend\u2502  \u2502 LanceBackend\u2502  \u2502PersistingBackend\u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502       (Pulsing)        (Persisting)     (Persisting)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"zh/guide/#_4","title":"\u6838\u5fc3\u200b\u6982\u5ff5","text":""},{"location":"zh/guide/#_5","title":"\u5b58\u50a8\u200b\u540e\u200b\u7aef","text":"<p>\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b <code>StorageBackend</code> \u200b\u534f\u8bae\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e0d\u540c\u200b\u7684\u200b\u5b58\u50a8\u200b\u7b56\u7565\u200b\uff1a</p> \u200b\u540e\u200b\u7aef\u200b \u200b\u4f4d\u7f6e\u200b \u200b\u6301\u4e45\u200b\u5316\u200b \u200b\u7528\u9014\u200b <code>MemoryBackend</code> Pulsing \u200b\u5426\u200b \u200b\u6d4b\u8bd5\u200b\u3001\u200b\u4e34\u65f6\u200b\u6570\u636e\u200b <code>LanceBackend</code> Persisting \u200b\u662f\u200b \u200b\u751f\u4ea7\u200b\u5de5\u4f5c\u200b\u8d1f\u8f7d\u200b <code>PersistingBackend</code> Persisting \u200b\u662f\u200b \u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\uff08WAL\u3001\u200b\u6307\u6807\u200b\uff09"},{"location":"zh/guide/#_6","title":"\u540e\u200b\u7aef\u200b\u6ce8\u518c","text":"<p>\u200b\u4f7f\u7528\u200b\u524d\u200b\u5fc5\u987b\u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef\u200b\uff1a</p> <pre><code>from pulsing.queue import register_backend\nfrom persisting.queue import LanceBackend\n\nregister_backend(\"lance\", LanceBackend)\n</code></pre>"},{"location":"zh/guide/#_7","title":"\u540e\u200b\u7aef\u200b\u9009\u62e9","text":"<p>\u200b\u521b\u5efa\u200b\u961f\u5217\u200b\u65f6\u200b\u6307\u5b9a\u200b\u540e\u200b\u7aef\u200b\uff1a</p> <pre><code>from pulsing.queue import write_queue\n\n# \u200b\u6309\u200b\u540d\u79f0\u200b\uff08\u200b\u5fc5\u987b\u200b\u5df2\u200b\u6ce8\u518c\u200b\uff09\nwriter = await write_queue(system, \"topic\", backend=\"lance\")\n\n# \u200b\u76f4\u63a5\u200b\u4f7f\u7528\u200b\u7c7b\u200b\nwriter = await write_queue(system, \"topic\", backend=LanceBackend)\n</code></pre>"},{"location":"zh/guide/#_8","title":"\u672c\u200b\u6307\u5357\u200b\u4e3b\u9898","text":"<ul> <li>\u200b\u961f\u5217\u200b\u540e\u200b\u7aef\u200b - \u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u6982\u8ff0\u200b</li> <li>Lance \u200b\u540e\u200b\u7aef\u200b - \u200b\u4f7f\u7528\u200b Lance \u200b\u8fdb\u884c\u200b\u6301\u4e45\u200b\u5316\u200b</li> <li>Persisting \u200b\u540e\u200b\u7aef\u200b - \u200b\u5e26\u200b WAL \u200b\u7684\u200b\u589e\u5f3a\u200b\u540e\u200b\u7aef\u200b</li> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef\u200b - \u200b\u5b9e\u73b0\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef\u200b</li> </ul>"},{"location":"zh/guide/#_9","title":"\u4e0b\u200b\u4e00\u6b65","text":"<p>\u200b\u9009\u62e9\u200b\u6700\u200b\u7b26\u5408\u200b\u4f60\u200b\u9700\u6c42\u200b\u7684\u200b\u4e3b\u9898\u200b\uff0c\u200b\u6216\u200b\u7ee7\u7eed\u200b\u9605\u8bfb\u200b\u961f\u5217\u200b\u540e\u200b\u7aef\u200b\u6982\u8ff0\u200b\u3002</p>"},{"location":"zh/guide/backends/","title":"\u961f\u5217\u200b\u540e\u200b\u7aef","text":"<p>\u200b\u672c\u200b\u6307\u5357\u200b\u6982\u8ff0\u200b Persisting \u200b\u4e2d\u200b\u53ef\u7528\u200b\u7684\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002</p>"},{"location":"zh/guide/backends/#_2","title":"\u540e\u200b\u7aef\u200b\u534f\u8bae","text":"<p>\u200b\u6240\u6709\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b <code>StorageBackend</code> \u200b\u534f\u8bae\u200b\uff1a</p> <pre><code>from typing import Protocol, AsyncIterator, Any\n\nclass StorageBackend(Protocol):\n    \"\"\"\u200b\u53ef\u200b\u63d2\u62d4\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u534f\u8bae\u200b\u3002\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"\u200b\u5b58\u50a8\u200b\u5355\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"\u200b\u5b58\u50a8\u200b\u591a\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def get(self, offset: int = 0, limit: int | None = None) -&gt; list[dict[str, Any]]:\n        \"\"\"\u200b\u68c0\u7d22\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def get_stream(\n        self,\n        offset: int = 0,\n        limit: int | None = None,\n        block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]:\n        \"\"\"\u200b\u6d41\u5f0f\u200b\u8bfb\u53d6\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def flush(self) -&gt; None:\n        \"\"\"\u200b\u6301\u4e45\u200b\u5316\u200b\u7f13\u51b2\u200b\u6570\u636e\u200b\u3002\"\"\"\n        ...\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"\u200b\u83b7\u53d6\u200b\u5b58\u50a8\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u3002\"\"\"\n        ...\n\n    def total_count(self) -&gt; int:\n        \"\"\"\u200b\u83b7\u53d6\u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b\u3002\"\"\"\n        ...\n</code></pre>"},{"location":"zh/guide/backends/#_3","title":"\u53ef\u7528\u200b\u540e\u200b\u7aef","text":""},{"location":"zh/guide/backends/#memorybackend-pulsing","title":"MemoryBackend (Pulsing)","text":"<p>\u200b\u65e0\u200b\u6301\u4e45\u200b\u5316\u200b\u7684\u200b\u7b80\u5355\u200b\u5185\u5b58\u200b\u5b58\u50a8\u200b\uff1a</p> <pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(system, \"topic\", backend=\"memory\")\n</code></pre> <p>\u200b\u7279\u6027\u200b\uff1a</p> <ul> <li>\u2705 \u200b\u5feb\u901f\u200b\u8bfb\u5199\u200b</li> <li>\u2705 \u200b\u65e0\u200b\u4f9d\u8d56\u200b</li> <li>\u274c \u200b\u65e0\u200b\u6301\u4e45\u200b\u5316\u200b</li> <li>\u274c \u200b\u91cd\u542f\u200b\u540e\u200b\u6570\u636e\u200b\u4e22\u5931\u200b</li> </ul> <p>\u200b\u7528\u9014\u200b\uff1a \u200b\u6d4b\u8bd5\u200b\u3001\u200b\u5f00\u53d1\u200b\u3001\u200b\u4e34\u65f6\u200b\u6570\u636e\u200b</p>"},{"location":"zh/guide/backends/#lancebackend-persisting","title":"LanceBackend (Persisting)","text":"<p>\u200b\u57fa\u4e8e\u200b Lance \u200b\u7684\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u200b\uff1a</p> <pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\nwriter = await pul.queue.write_queue(system, \"topic\", backend=\"lance\", storage_path=\"/data\")\n</code></pre> <p>\u200b\u7279\u6027\u200b\uff1a</p> <ul> <li>\u2705 \u200b\u9ad8\u6027\u80fd\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b</li> <li>\u2705 \u200b\u6570\u636e\u200b\u6301\u4e45\u200b\u5316\u200b</li> <li>\u2705 \u200b\u7248\u672c\u63a7\u5236\u200b</li> <li>\u2705 \u200b\u5411\u91cf\u200b\u641c\u7d22\u200b\u652f\u6301\u200b</li> </ul> <p>\u200b\u7528\u9014\u200b\uff1a \u200b\u751f\u4ea7\u200b\u5de5\u4f5c\u200b\u8d1f\u8f7d\u200b\u3001ML \u200b\u6570\u636e\u200b\u5b58\u50a8\u200b</p>"},{"location":"zh/guide/backends/#persistingbackend-persisting","title":"PersistingBackend (Persisting)","text":"<p>\u200b\u5177\u6709\u200b\u9ad8\u7ea7\u200b\u529f\u80fd\u200b\u7684\u200b\u589e\u5f3a\u200b\u540e\u200b\u7aef\u200b\uff1a</p> <pre><code>import pulsing as pul\nimport persisting as pst\n\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    storage_path=\"/data\",\n    backend_options={\"enable_wal\": True}\n)\n</code></pre> <p>\u200b\u7279\u6027\u200b\uff1a</p> <ul> <li>\u2705 \u200b\u6240\u6709\u200b Lance \u200b\u529f\u80fd\u200b</li> <li>\u2705 Write-Ahead Log (WAL)</li> <li>\u2705 Schema \u200b\u6f14\u8fdb\u200b</li> <li>\u2705 Prometheus \u200b\u6307\u6807\u200b</li> </ul> <p>\u200b\u7528\u9014\u200b\uff1a \u200b\u6709\u200b\u6301\u4e45\u6027\u200b\u8981\u6c42\u200b\u7684\u200b\u751f\u4ea7\u200b\u73af\u5883\u200b</p>"},{"location":"zh/guide/backends/#_4","title":"\u540e\u200b\u7aef\u200b\u6bd4\u8f83","text":"\u529f\u80fd\u200b Memory Lance Persisting \u200b\u6301\u4e45\u200b\u5316\u200b \u274c \u2705 \u2705 WAL \u274c \u274c \u2705 \u200b\u538b\u7f29\u200b \u274c \u2705 \u2705 \u200b\u6307\u6807\u200b \u274c \u274c \u2705 Schema \u200b\u6f14\u8fdb\u200b N/A \u274c \u2705 \u200b\u5411\u91cf\u200b\u641c\u7d22\u200b \u274c \u2705 \u2705"},{"location":"zh/guide/backends/#_5","title":"\u540e\u200b\u7aef\u200b\u6ce8\u518c","text":"<p>\u200b\u5411\u200b Pulsing \u200b\u6ce8\u518c\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef\u200b\uff1a</p> <pre><code>import pulsing as pul\n\n# \u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef\u200b\npul.queue.register_backend(\"my_backend\", MyBackendClass)\n\n# \u200b\u83b7\u53d6\u200b\u5df2\u200b\u6ce8\u518c\u200b\u7684\u200b\u540e\u200b\u7aef\u200b\nbackend_class = pul.queue.get_backend_class(\"my_backend\")\n\n# \u200b\u5217\u51fa\u200b\u6240\u6709\u200b\u540e\u200b\u7aef\u200b\navailable = pul.queue.list_backends()\nprint(available)  # ['memory', 'my_backend', ...]\n</code></pre>"},{"location":"zh/guide/backends/#_6","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>Lance \u200b\u540e\u200b\u7aef\u200b - \u200b\u8be6\u7ec6\u200b\u7684\u200b Lance \u200b\u540e\u200b\u7aef\u200b\u6307\u5357\u200b</li> <li>Persisting \u200b\u540e\u200b\u7aef\u200b - \u200b\u589e\u5f3a\u200b\u540e\u200b\u7aef\u200b\u529f\u80fd\u200b</li> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef\u200b - \u200b\u5b9e\u73b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u540e\u200b\u7aef\u200b</li> </ul>"},{"location":"zh/guide/custom/","title":"\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef","text":"<p>\u200b\u672c\u200b\u6307\u5357\u200b\u5c55\u793a\u200b\u5982\u4f55\u200b\u4e3a\u200b Pulsing \u200b\u961f\u5217\u200b\u5b9e\u73b0\u200b\u81ea\u5b9a\u4e49\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u3002</p>"},{"location":"zh/guide/custom/#storagebackend","title":"StorageBackend \u200b\u534f\u8bae","text":"<p>\u200b\u6240\u6709\u200b\u540e\u200b\u7aef\u200b\u5fc5\u987b\u200b\u5b9e\u73b0\u200b <code>StorageBackend</code> \u200b\u534f\u8bae\u200b\uff1a</p> <pre><code>from typing import Protocol, AsyncIterator, Any\n\nclass StorageBackend(Protocol):\n    \"\"\"\u200b\u53ef\u200b\u63d2\u62d4\u200b\u5b58\u50a8\u200b\u540e\u200b\u7aef\u200b\u534f\u8bae\u200b\u3002\"\"\"\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"\u200b\u5b58\u50a8\u200b\u5355\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"\u200b\u9ad8\u6548\u200b\u5b58\u50a8\u200b\u591a\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def get(\n        self,\n        offset: int = 0,\n        limit: int | None = None\n    ) -&gt; list[dict[str, Any]]:\n        \"\"\"\u200b\u4ece\u200b\u5b58\u50a8\u200b\u68c0\u7d22\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def get_stream(\n        self,\n        offset: int = 0,\n        limit: int | None = None,\n        block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]:\n        \"\"\"\u200b\u4ece\u200b\u5b58\u50a8\u200b\u6d41\u5f0f\u200b\u8bfb\u53d6\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        ...\n\n    async def flush(self) -&gt; None:\n        \"\"\"\u200b\u6301\u4e45\u200b\u5316\u200b\u4efb\u4f55\u200b\u7f13\u51b2\u200b\u6570\u636e\u200b\u3002\"\"\"\n        ...\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"\u200b\u8fd4\u56de\u200b\u5b58\u50a8\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u3002\"\"\"\n        ...\n\n    def total_count(self) -&gt; int:\n        \"\"\"\u200b\u8fd4\u56de\u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b\u3002\"\"\"\n        ...\n</code></pre>"},{"location":"zh/guide/custom/#_2","title":"\u57fa\u672c\u200b\u5b9e\u73b0","text":"<p>\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>import asyncio\nfrom typing import Any, AsyncIterator\n\nclass SimpleBackend:\n    \"\"\"\u200b\u7b80\u5355\u200b\u7684\u200b\u5185\u5b58\u200b\u540e\u200b\u7aef\u200b\u3002\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        **kwargs,\n    ):\n        self.bucket_id = bucket_id\n        self.storage_path = storage_path\n        self.batch_size = batch_size\n        self._records: list[dict[str, Any]] = []\n        self._condition = asyncio.Condition()\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        \"\"\"\u200b\u5b58\u50a8\u200b\u5355\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        async with self._condition:\n            self._records.append(record)\n            self._condition.notify_all()\n\n    async def put_batch(self, records: list[dict[str, Any]]) -&gt; None:\n        \"\"\"\u200b\u5b58\u50a8\u200b\u591a\u6761\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        async with self._condition:\n            self._records.extend(records)\n            self._condition.notify_all()\n\n    async def get(\n        self,\n        offset: int = 0,\n        limit: int | None = None\n    ) -&gt; list[dict[str, Any]]:\n        \"\"\"\u200b\u68c0\u7d22\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        if limit is None:\n            return self._records[offset:]\n        return self._records[offset:offset + limit]\n\n    async def get_stream(\n        self,\n        offset: int = 0,\n        limit: int | None = None,\n        block: bool = False\n    ) -&gt; AsyncIterator[dict[str, Any]]:\n        \"\"\"\u200b\u6d41\u5f0f\u200b\u8bfb\u53d6\u200b\u8bb0\u5f55\u200b\u3002\"\"\"\n        current = offset\n        count = 0\n\n        while True:\n            async with self._condition:\n                while current &gt;= len(self._records):\n                    if not block:\n                        return\n                    await self._condition.wait()\n\n                while current &lt; len(self._records):\n                    if limit is not None and count &gt;= limit:\n                        return\n                    yield self._records[current]\n                    current += 1\n                    count += 1\n\n    async def flush(self) -&gt; None:\n        \"\"\"\u200b\u5185\u5b58\u200b\u5b58\u50a8\u200b\u65e0\u200b\u64cd\u4f5c\u200b\u3002\"\"\"\n        pass\n\n    async def stats(self) -&gt; dict[str, Any]:\n        \"\"\"\u200b\u8fd4\u56de\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\u3002\"\"\"\n        return {\n            \"bucket_id\": self.bucket_id,\n            \"total_count\": len(self._records),\n            \"buffer_count\": 0,\n            \"persisted_count\": len(self._records),\n        }\n\n    def total_count(self) -&gt; int:\n        \"\"\"\u200b\u8fd4\u56de\u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b\u3002\"\"\"\n        return len(self._records)\n</code></pre>"},{"location":"zh/guide/custom/#_3","title":"\u6ce8\u518c\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef","text":"<pre><code>import pulsing as pul\n\n# \u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef\u200b\npul.queue.register_backend(\"simple\", SimpleBackend)\n\n# \u200b\u4f7f\u7528\u200b\u5b83\u200b\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"my_topic\",\n    backend=\"simple\",\n)\n</code></pre>"},{"location":"zh/guide/custom/#_4","title":"\u9ad8\u7ea7\u200b\u5b9e\u73b0","text":""},{"location":"zh/guide/custom/#_5","title":"\u5e26\u200b\u6301\u4e45\u200b\u5316","text":"<pre><code>import json\nfrom pathlib import Path\n\nclass FileBackend:\n    \"\"\"\u200b\u57fa\u4e8e\u200b\u6587\u4ef6\u200b\u7684\u200b\u6301\u4e45\u200b\u5316\u540e\u200b\u7aef\u200b\u3002\"\"\"\n\n    def __init__(\n        self,\n        bucket_id: int,\n        storage_path: str,\n        batch_size: int = 100,\n        **kwargs,\n    ):\n        self.bucket_id = bucket_id\n        self.storage_path = Path(storage_path)\n        self.batch_size = batch_size\n        self._buffer: list[dict[str, Any]] = []\n        self._persisted_count = 0\n        self._condition = asyncio.Condition()\n\n        # \u200b\u52a0\u8f7d\u200b\u73b0\u6709\u200b\u6570\u636e\u200b\n        self._load()\n\n    def _load(self) -&gt; None:\n        \"\"\"\u200b\u52a0\u8f7d\u200b\u6301\u4e45\u200b\u5316\u200b\u6570\u636e\u200b\u3002\"\"\"\n        self.storage_path.mkdir(parents=True, exist_ok=True)\n        data_file = self.storage_path / \"data.json\"\n        if data_file.exists():\n            with open(data_file) as f:\n                data = json.load(f)\n                self._persisted_count = len(data)\n\n    async def put(self, record: dict[str, Any]) -&gt; None:\n        async with self._condition:\n            self._buffer.append(record)\n            if len(self._buffer) &gt;= self.batch_size:\n                await self._flush_internal()\n            self._condition.notify_all()\n\n    async def _flush_internal(self) -&gt; None:\n        \"\"\"\u200b\u5185\u90e8\u200b\u5237\u65b0\u200b\uff08\u200b\u65e0\u9501\u200b\uff09\u3002\"\"\"\n        if not self._buffer:\n            return\n\n        data_file = self.storage_path / \"data.json\"\n\n        # \u200b\u52a0\u8f7d\u200b\u73b0\u6709\u200b\u6570\u636e\u200b\n        existing = []\n        if data_file.exists():\n            with open(data_file) as f:\n                existing = json.load(f)\n\n        # \u200b\u8ffd\u52a0\u200b\u65b0\u200b\u6570\u636e\u200b\n        existing.extend(self._buffer)\n\n        # \u200b\u5199\u56de\u200b\n        with open(data_file, \"w\") as f:\n            json.dump(existing, f)\n\n        self._persisted_count += len(self._buffer)\n        self._buffer.clear()\n\n    async def flush(self) -&gt; None:\n        \"\"\"\u200b\u6301\u4e45\u200b\u5316\u200b\u7f13\u51b2\u200b\u6570\u636e\u200b\u3002\"\"\"\n        async with self._condition:\n            await self._flush_internal()\n</code></pre>"},{"location":"zh/guide/custom/#_6","title":"\u5e26\u200b\u963b\u585e\u200b\u652f\u6301","text":"<p><code>get_stream</code> \u200b\u65b9\u6cd5\u200b\u5728\u200b <code>block=True</code> \u200b\u65f6\u5e94\u200b\u7b49\u5f85\u200b\u65b0\u200b\u6570\u636e\u200b\uff1a</p> <pre><code>async def get_stream(\n    self,\n    offset: int = 0,\n    limit: int | None = None,\n    block: bool = False\n) -&gt; AsyncIterator[dict[str, Any]]:\n    \"\"\"\u200b\u5e26\u200b\u963b\u585e\u200b\u652f\u6301\u200b\u7684\u200b\u6d41\u5f0f\u200b\u8bfb\u53d6\u200b\u3002\"\"\"\n    current = offset\n    count = 0\n\n    while True:\n        async with self._condition:\n            # \u200b\u5982\u679c\u200b\u963b\u585e\u200b\u5219\u200b\u7b49\u5f85\u200b\u6570\u636e\u200b\n            while current &gt;= self.total_count():\n                if not block:\n                    return\n                # \u200b\u5e26\u200b\u8d85\u65f6\u200b\u7b49\u5f85\u200b\u4ee5\u200b\u5b9a\u671f\u68c0\u67e5\u200b\n                try:\n                    await asyncio.wait_for(\n                        self._condition.wait(),\n                        timeout=1.0\n                    )\n                except asyncio.TimeoutError:\n                    continue\n\n            # \u200b\u83b7\u53d6\u200b\u53ef\u7528\u200b\u8bb0\u5f55\u200b\n            records = await self.get(current, limit)\n\n        for record in records:\n            if limit is not None and count &gt;= limit:\n                return\n            yield record\n            current += 1\n            count += 1\n</code></pre>"},{"location":"zh/guide/custom/#_7","title":"\u6d4b\u8bd5\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef","text":"<pre><code>import pytest\nimport pulsing as pul\n\n@pytest.fixture\ndef custom_backend():\n    pul.queue.register_backend(\"custom\", CustomBackend)\n    yield\n    # \u200b\u5982\u9700\u200b\u6e05\u7406\u200b\n\n@pytest.mark.asyncio\nasync def test_custom_backend_write_read(actor_system, custom_backend):\n    # \u200b\u5199\u5165\u200b\n    writer = await pul.queue.write_queue(\n        actor_system,\n        topic=\"test\",\n        backend=\"custom\",\n        storage_path=\"/tmp/test\",\n    )\n\n    await writer.put({\"id\": \"1\", \"value\": 42})\n    await writer.flush()\n\n    # \u200b\u8bfb\u53d6\u200b\n    reader = await pul.queue.read_queue(actor_system, \"test\")\n    records = await reader.get(limit=10)\n\n    assert len(records) == 1\n    assert records[0][\"id\"] == \"1\"\n</code></pre>"},{"location":"zh/guide/custom/#_8","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":"<ol> <li>\u200b\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff1a\u200b\u4f7f\u7528\u200b <code>asyncio.Condition</code> \u200b\u4fdd\u8bc1\u200b\u5b89\u5168\u200b\u7684\u200b\u5e76\u53d1\u200b\u8bbf\u95ee\u200b</li> <li>\u200b\u7f13\u51b2\u200b\uff1a\u200b\u7f13\u51b2\u200b\u5199\u5165\u200b\u4ee5\u200b\u83b7\u5f97\u200b\u66f4\u597d\u200b\u7684\u200b\u6027\u80fd\u200b</li> <li>\u200b\u9519\u8bef\u5904\u7406\u200b\uff1a\u200b\u4f18\u96c5\u200b\u5730\u200b\u5904\u7406\u200b\u5b58\u50a8\u200b\u9519\u8bef\u200b</li> <li>\u200b\u7edf\u8ba1\u200b\u4fe1\u606f\u200b\uff1a\u200b\u63d0\u4f9b\u200b\u6709\u7528\u200b\u7684\u200b\u76d1\u63a7\u200b\u7edf\u8ba1\u200b</li> <li>\u200b\u6d4b\u8bd5\u200b\uff1a\u200b\u7f16\u5199\u200b\u5168\u9762\u200b\u7684\u200b\u6d4b\u8bd5\u200b</li> </ol>"},{"location":"zh/guide/custom/#_9","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u67b6\u6784\u8bbe\u8ba1\u200b - \u200b\u8bbe\u8ba1\u200b\u8be6\u60c5\u200b</li> <li>API \u200b\u53c2\u8003\u200b - \u200b\u8be6\u7ec6\u200b API \u200b\u6587\u6863\u200b</li> </ul>"},{"location":"zh/guide/lance/","title":"Lance \u200b\u540e\u200b\u7aef","text":"<p>Lance \u200b\u540e\u200b\u7aef\u200b\u4f7f\u7528\u200b Lance \u200b\u5217\u5f0f\u200b\u6570\u636e\u683c\u5f0f\u200b\u63d0\u4f9b\u200b\u9ad8\u6027\u80fd\u200b\u6301\u4e45\u200b\u5316\u200b\u5b58\u50a8\u200b\u3002</p>"},{"location":"zh/guide/lance/#_1","title":"\u6982\u8ff0","text":"<p>Lance \u200b\u662f\u200b\u4e3a\u200b ML \u200b\u5de5\u4f5c\u200b\u6d41\u200b\u4f18\u5316\u200b\u7684\u200b\u73b0\u4ee3\u200b\u5217\u5f0f\u200b\u6570\u636e\u683c\u5f0f\u200b\u3002<code>LanceBackend</code> \u200b\u4e3a\u200b Pulsing \u200b\u961f\u5217\u200b\u5e26\u6765\u200b\u4ee5\u4e0b\u200b\u80fd\u529b\u200b\uff1a</p> <ul> <li>\u200b\u9ad8\u6027\u80fd\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b - \u200b\u9ad8\u6548\u200b\u68c0\u7d22\u200b\u4efb\u610f\u200b\u8bb0\u5f55\u200b</li> <li>\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b - \u200b\u5206\u6790\u200b\u67e5\u8be2\u200b\u7684\u200b\u6700\u4f73\u200b\u9009\u62e9\u200b</li> <li>\u200b\u7248\u672c\u63a7\u5236\u200b - \u200b\u5185\u7f6e\u200b\u6570\u636e\u200b\u7248\u672c\u200b\u7ba1\u7406\u200b</li> <li>\u200b\u5411\u91cf\u200b\u641c\u7d22\u200b - \u200b\u539f\u751f\u200b\u652f\u6301\u200b\u76f8\u4f3c\u6027\u200b\u641c\u7d22\u200b</li> </ul>"},{"location":"zh/guide/lance/#_2","title":"\u5b89\u88c5","text":"<pre><code>pip install persisting[pulsing]\n</code></pre>"},{"location":"zh/guide/lance/#_3","title":"\u57fa\u672c\u200b\u7528\u6cd5","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# \u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef\u200b\npul.queue.register_backend(\"lance\", pst.queue.LanceBackend)\n\n# \u200b\u521b\u5efa\u200b\u5199\u5165\u200b\u5668\u200b\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"my_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n)\n\n# \u200b\u5199\u5165\u200b\u6570\u636e\u200b\nawait writer.put({\"id\": \"1\", \"text\": \"Hello\", \"vector\": [0.1, 0.2, 0.3]})\nawait writer.put({\"id\": \"2\", \"text\": \"World\", \"vector\": [0.4, 0.5, 0.6]})\n\n# \u200b\u5237\u65b0\u200b\u4ee5\u200b\u6301\u4e45\u200b\u5316\u200b\nawait writer.flush()\n\n# \u200b\u8bfb\u53d6\u6570\u636e\u200b\nreader = await pul.queue.read_queue(system, \"my_topic\")\nrecords = await reader.get(limit=10)\n</code></pre>"},{"location":"zh/guide/lance/#_4","title":"\u914d\u7f6e","text":""},{"location":"zh/guide/lance/#_5","title":"\u540e\u200b\u7aef\u200b\u9009\u9879","text":"\u9009\u9879\u200b \u200b\u7c7b\u578b\u200b \u200b\u9ed8\u8ba4\u503c\u200b \u200b\u8bf4\u660e\u200b <code>flush_threshold</code> int 1000 \u200b\u81ea\u52a8\u200b\u5237\u65b0\u200b\u524d\u200b\u7684\u200b\u8bb0\u5f55\u200b\u6570"},{"location":"zh/guide/lance/#_6","title":"\u914d\u7f6e\u200b\u793a\u4f8b","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"configured_topic\",\n    backend=\"lance\",\n    storage_path=\"/data/queues\",\n    batch_size=100,\n    backend_options={\n        \"flush_threshold\": 500,\n    },\n)\n</code></pre>"},{"location":"zh/guide/lance/#_7","title":"\u6570\u636e\u200b\u5b58\u50a8","text":""},{"location":"zh/guide/lance/#_8","title":"\u76ee\u5f55\u200b\u7ed3\u6784","text":"<pre><code>/data/queues/\n\u2514\u2500\u2500 my_topic/\n    \u2514\u2500\u2500 bucket_0/\n        \u251c\u2500\u2500 data.lance/\n        \u2502   \u251c\u2500\u2500 _versions/\n        \u2502   \u2502   \u251c\u2500\u2500 1.manifest\n        \u2502   \u2502   \u2514\u2500\u2500 2.manifest\n        \u2502   \u2514\u2500\u2500 data/\n        \u2502       \u251c\u2500\u2500 0.lance\n        \u2502       \u2514\u2500\u2500 1.lance\n        \u2514\u2500\u2500 ...\n</code></pre>"},{"location":"zh/guide/lance/#schema","title":"Schema","text":"<p>Lance \u200b\u540e\u7aef\u200b\u4ece\u200b\u7b2c\u4e00\u6761\u200b\u8bb0\u5f55\u200b\u81ea\u52a8\u200b\u63a8\u65ad\u200b Schema\uff1a</p> <pre><code># \u200b\u7b2c\u4e00\u6761\u200b\u8bb0\u5f55\u200b\u5b9a\u4e49\u200b Schema\nawait writer.put({\n    \"id\": \"1\",\n    \"text\": \"Hello\",\n    \"value\": 42,\n    \"vector\": [0.1, 0.2, 0.3],\n})\n\n# \u200b\u540e\u7eed\u200b\u8bb0\u5f55\u200b\u5fc5\u987b\u200b\u5339\u914d\u200b Schema\nawait writer.put({\n    \"id\": \"2\",\n    \"text\": \"World\",\n    \"value\": 100,\n    \"vector\": [0.4, 0.5, 0.6],\n})\n</code></pre>"},{"location":"zh/guide/lance/#_9","title":"\u6027\u80fd","text":""},{"location":"zh/guide/lance/#_10","title":"\u7f13\u51b2","text":"<p>Lance \u200b\u540e\u7aef\u200b\u5728\u200b\u6301\u4e45\u200b\u5316\u524d\u200b\u5c06\u200b\u8bb0\u5f55\u200b\u7f13\u51b2\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\uff1a</p> <pre><code># \u200b\u8bb0\u5f55\u200b\u88ab\u200b\u7f13\u51b2\u200b\nfor i in range(100):\n    await writer.put({\"id\": str(i), \"value\": i})\n\n# \u200b\u663e\u5f0f\u200b\u5237\u65b0\u200b\u6301\u4e45\u200b\u5316\u5230\u200b\u78c1\u76d8\u200b\nawait writer.flush()\n</code></pre>"},{"location":"zh/guide/lance/#_11","title":"\u81ea\u52a8\u200b\u5237\u65b0","text":"<p>\u200b\u8fbe\u5230\u200b <code>flush_threshold</code> \u200b\u65f6\u200b\uff0c\u200b\u6570\u636e\u200b\u81ea\u52a8\u200b\u6301\u4e45\u200b\u5316\u200b\uff1a</p> <pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"lance\",\n    backend_options={\"flush_threshold\": 500},\n)\n\n# 500 \u200b\u6761\u200b\u8bb0\u5f55\u200b\u540e\u200b\uff0c\u200b\u81ea\u52a8\u200b\u5237\u65b0\u200b\nfor i in range(600):\n    await writer.put({\"id\": str(i), \"value\": i})\n</code></pre>"},{"location":"zh/guide/lance/#_12","title":"\u6d41\u5f0f\u200b\u5904\u7406","text":"<p>Lance \u200b\u540e\u200b\u7aef\u200b\u652f\u6301\u200b\u9ad8\u6548\u200b\u7684\u200b\u6d41\u5f0f\u200b\u5904\u7406\u200b\uff1a</p> <pre><code>import pulsing as pul\n\nreader = await pul.queue.read_queue(system, \"my_topic\")\n\n# \u200b\u975e\u200b\u963b\u585e\u200b\u6d41\u200b\nasync for record in reader.get_stream(offset=0, limit=100):\n    process(record)\n\n# \u200b\u963b\u585e\u200b\u6d41\u200b\uff08\u200b\u7b49\u5f85\u200b\u65b0\u200b\u6570\u636e\u200b\uff09\nasync for record in reader.get_stream(block=True):\n    process(record)\n</code></pre>"},{"location":"zh/guide/lance/#_13","title":"\u7edf\u8ba1\u200b\u4fe1\u606f","text":"<p>\u200b\u83b7\u53d6\u200b\u5b58\u50a8\u200b\u7edf\u8ba1\u200b\uff1a</p> <pre><code>stats = await writer.stats()\nprint(f\"\u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b: {stats['total_count']}\")\nprint(f\"\u200b\u7f13\u51b2\u200b\u4e2d\u200b: {stats['buffer_count']}\")\nprint(f\"\u200b\u5df2\u200b\u6301\u4e45\u200b\u5316\u200b: {stats['persisted_count']}\")\n</code></pre>"},{"location":"zh/guide/lance/#_14","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":"<ol> <li>\u200b\u9009\u62e9\u200b\u5408\u9002\u200b\u7684\u200b\u6279\u6b21\u200b\u5927\u5c0f\u200b - \u200b\u66f4\u5927\u200b\u7684\u200b\u6279\u6b21\u200b\u63d0\u9ad8\u200b\u5199\u5165\u200b\u541e\u5410\u91cf\u200b</li> <li>\u200b\u5b9a\u671f\u200b\u5237\u65b0\u200b - \u200b\u8c03\u7528\u200b <code>flush()</code> \u200b\u786e\u4fdd\u200b\u6570\u636e\u200b\u6301\u4e45\u6027\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u5408\u9002\u200b\u7684\u200b\u5b58\u50a8\u200b\u8def\u5f84\u200b - \u200b\u751f\u4ea7\u200b\u73af\u5883\u200b\u4f7f\u7528\u200b\u5feb\u901f\u200b SSD \u200b\u5b58\u50a8\u200b</li> <li>\u200b\u76d1\u63a7\u200b\u7f13\u51b2\u533a\u200b\u5927\u5c0f\u200b - \u200b\u907f\u514d\u200b\u5927\u200b\u7f13\u51b2\u533a\u200b\u9020\u6210\u200b\u5185\u5b58\u200b\u538b\u529b\u200b</li> </ol>"},{"location":"zh/guide/lance/#_15","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>Persisting \u200b\u540e\u200b\u7aef\u200b - \u200b\u5e26\u200b WAL \u200b\u7684\u200b\u589e\u5f3a\u200b\u529f\u80fd\u200b</li> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef\u200b - \u200b\u5b9e\u73b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u540e\u200b\u7aef\u200b</li> <li>API \u200b\u53c2\u8003\u200b - \u200b\u8be6\u7ec6\u200b API \u200b\u6587\u6863\u200b</li> </ul>"},{"location":"zh/guide/persisting/","title":"Persisting \u200b\u540e\u200b\u7aef","text":"<p>Persisting \u200b\u540e\u200b\u7aef\u200b\u6269\u5c55\u200b\u4e86\u200b Lance \u200b\u540e\u200b\u7aef\u200b\uff0c\u200b\u4e3a\u200b\u751f\u4ea7\u200b\u90e8\u7f72\u200b\u63d0\u4f9b\u200b\u4f01\u4e1a\u7ea7\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"zh/guide/persisting/#_1","title":"\u6982\u8ff0","text":"<p><code>PersistingBackend</code> \u200b\u63d0\u4f9b\u200b\u6240\u6709\u200b Lance \u200b\u529f\u80fd\u200b\uff0c\u200b\u5916\u52a0\u200b\uff1a</p> <ul> <li>Write-Ahead Log (WAL) - \u200b\u5d29\u6e83\u200b\u6062\u590d\u200b\u548c\u200b\u6570\u636e\u200b\u6301\u4e45\u6027\u200b</li> <li>Schema \u200b\u6f14\u8fdb\u200b - \u200b\u65e0\u200b\u505c\u673a\u200b\u52a8\u6001\u200b Schema \u200b\u53d8\u66f4\u200b</li> <li>\u200b\u538b\u7f29\u200b - \u200b\u591a\u79cd\u200b\u538b\u7f29\u7b97\u6cd5\u200b</li> <li>\u200b\u76d1\u63a7\u200b - Prometheus \u200b\u6307\u6807\u200b\u5bfc\u51fa\u200b</li> </ul>"},{"location":"zh/guide/persisting/#_2","title":"\u5b89\u88c5","text":"<pre><code>pip install persisting[pulsing]\n</code></pre>"},{"location":"zh/guide/persisting/#_3","title":"\u57fa\u672c\u200b\u7528\u6cd5","text":"<pre><code>import pulsing as pul\nimport persisting as pst\n\n# \u200b\u6ce8\u518c\u200b\u540e\u200b\u7aef\u200b\npul.queue.register_backend(\"persisting\", pst.queue.PersistingBackend)\n\n# \u200b\u521b\u5efa\u200b\u5e26\u200b\u589e\u5f3a\u200b\u529f\u80fd\u200b\u7684\u200b\u5199\u5165\u200b\u5668\u200b\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"production_topic\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n        \"enable_metrics\": True,\n    },\n)\n\n# \u200b\u5199\u5165\u200b\u6570\u636e\u200b\nawait writer.put({\"id\": \"1\", \"value\": 42})\nawait writer.flush()\n</code></pre>"},{"location":"zh/guide/persisting/#_4","title":"\u914d\u7f6e","text":""},{"location":"zh/guide/persisting/#_5","title":"\u540e\u200b\u7aef\u200b\u9009\u9879","text":"\u9009\u9879\u200b \u200b\u7c7b\u578b\u200b \u200b\u9ed8\u8ba4\u503c\u200b \u200b\u8bf4\u660e\u200b <code>enable_wal</code> bool False \u200b\u542f\u7528\u200b Write-Ahead Log <code>compression</code> str None \u200b\u538b\u7f29\u200b: \"zstd\", \"lz4\", \"snappy\" <code>enable_metrics</code> bool False \u200b\u542f\u7528\u200b Prometheus \u200b\u6307\u6807\u200b <code>wal_sync_interval</code> float 1.0 WAL \u200b\u540c\u6b65\u200b\u95f4\u9694\u200b\uff08\u200b\u79d2\u200b\uff09 <code>max_wal_size</code> int 100MB \u200b\u6700\u5927\u200b WAL \u200b\u6587\u4ef6\u5927\u5c0f"},{"location":"zh/guide/persisting/#_6","title":"\u5b8c\u6574\u200b\u914d\u7f6e\u200b\u793a\u4f8b","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"advanced_topic\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    batch_size=100,\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n        \"enable_metrics\": True,\n        \"wal_sync_interval\": 0.5,\n        \"max_wal_size\": 50 * 1024 * 1024,  # 50MB\n    },\n)\n</code></pre>"},{"location":"zh/guide/persisting/#_7","title":"\u6982\u8ff0","text":"<p>WAL \u200b\u901a\u8fc7\u200b\u5728\u200b\u5e94\u7528\u200b\u66f4\u6539\u200b\u524d\u200b\u5c06\u200b\u5176\u200b\u5199\u5165\u200b\u65e5\u5fd7\u200b\u6765\u200b\u786e\u4fdd\u200b\u6570\u636e\u200b\u6301\u4e45\u6027\u200b\uff1a</p> <pre><code>\u200b\u5199\u5165\u200b\u8bf7\u6c42\u200b \u2192 WAL \u2192 \u200b\u7f13\u51b2\u533a\u200b \u2192 Lance \u200b\u5b58\u50a8\u200b\n            \u2193\n       (\u200b\u5d29\u6e83\u200b\u6062\u590d\u200b)\n</code></pre>"},{"location":"zh/guide/persisting/#wal","title":"\u542f\u7528\u200b WAL","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    backend_options={\"enable_wal\": True},\n)\n</code></pre>"},{"location":"zh/guide/persisting/#_8","title":"\u6062\u590d","text":"<p>\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u540e\u200b\u7aef\u200b\u81ea\u52a8\u200b\u4ece\u200b WAL \u200b\u6062\u590d\u200b\u672a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6570\u636e\u200b\uff1a</p> <pre><code>import pulsing as pul\n\n# \u200b\u5d29\u6e83\u200b\u540e\u200b\uff0c\u200b\u6570\u636e\u200b\u81ea\u52a8\u200b\u6062\u590d\u200b\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    backend_options={\"enable_wal\": True},\n)\n# \u200b\u6240\u6709\u200b\u672a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6570\u636e\u200b\u73b0\u5728\u200b\u53ef\u7528\u200b\n</code></pre>"},{"location":"zh/guide/persisting/#schema","title":"Schema \u200b\u6f14\u8fdb","text":""},{"location":"zh/guide/persisting/#_9","title":"\u6dfb\u52a0\u200b\u5b57\u200b\u6bb5","text":"<pre><code># \u200b\u539f\u59cb\u200b Schema\nawait writer.put({\"id\": \"1\", \"name\": \"Alice\"})\n\n# \u200b\u6dfb\u52a0\u200b\u65b0\u5b57\u200b\u6bb5\u200b\uff08\u200b\u5e26\u200b\u9ed8\u8ba4\u503c\u200b\uff09\nawait writer.put({\"id\": \"2\", \"name\": \"Bob\", \"age\": 30})\n\n# \u200b\u7f3a\u5931\u200b\u5b57\u200b\u6bb5\u200b\u83b7\u5f97\u200b\u9ed8\u8ba4\u503c\u200b\n</code></pre>"},{"location":"zh/guide/persisting/#_10","title":"\u5b57\u200b\u6bb5\u200b\u7c7b\u578b\u200b\u53d8\u66f4","text":"<pre><code># PersistingBackend \u200b\u5904\u7406\u200b\u517c\u5bb9\u200b\u7684\u200b\u7c7b\u578b\u200b\u53d8\u66f4\u200b\n# int \u2192 float \u200b\u7b49\u200b\n</code></pre>"},{"location":"zh/guide/persisting/#_11","title":"\u538b\u7f29","text":""},{"location":"zh/guide/persisting/#_12","title":"\u53ef\u7528\u200b\u7b97\u6cd5","text":"\u7b97\u6cd5\u200b \u200b\u538b\u7f29\u6bd4\u200b \u200b\u901f\u5ea6\u200b \u200b\u7528\u9014\u200b <code>zstd</code> \u200b\u9ad8\u200b \u200b\u4e2d\u7b49\u200b \u200b\u901a\u7528\u200b <code>lz4</code> \u200b\u4e2d\u7b49\u200b \u200b\u5feb\u200b \u200b\u4f4e\u200b\u5ef6\u8fdf\u200b <code>snappy</code> \u200b\u4f4e\u200b \u200b\u975e\u5e38\u200b\u5feb\u200b \u200b\u5b9e\u65f6"},{"location":"zh/guide/persisting/#_13","title":"\u793a\u4f8b","text":"<pre><code>import pulsing as pul\n\nwriter = await pul.queue.write_queue(\n    system, \"topic\",\n    backend=\"persisting\",\n    backend_options={\"compression\": \"zstd\"},\n)\n</code></pre>"},{"location":"zh/guide/persisting/#_14","title":"\u76d1\u63a7","text":""},{"location":"zh/guide/persisting/#prometheus","title":"Prometheus \u200b\u6307\u6807","text":"<p>\u200b\u5f53\u200b <code>enable_metrics=True</code> \u200b\u65f6\u200b\uff0c\u200b\u5bfc\u51fa\u200b\u4ee5\u4e0b\u200b\u6307\u6807\u200b\uff1a</p> \u200b\u6307\u6807\u200b \u200b\u7c7b\u578b\u200b \u200b\u8bf4\u660e\u200b <code>persisting_records_total</code> Counter \u200b\u5199\u5165\u200b\u7684\u200b\u603b\u200b\u8bb0\u5f55\u200b\u6570\u200b <code>persisting_buffer_size</code> Gauge \u200b\u5f53\u524d\u200b\u7f13\u51b2\u533a\u200b\u5927\u5c0f\u200b <code>persisting_flush_duration_seconds</code> Histogram \u200b\u5237\u65b0\u200b\u5ef6\u8fdf\u200b <code>persisting_wal_size_bytes</code> Gauge WAL \u200b\u6587\u4ef6\u5927\u5c0f"},{"location":"zh/guide/persisting/#_15","title":"\u8bbf\u95ee\u200b\u6307\u6807","text":"<pre><code># \u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7edf\u8ba1\u200b\nstats = await writer.stats()\nprint(stats)\n# {\n#     'total_count': 1000,\n#     'buffer_count': 50,\n#     'persisted_count': 950,\n#     'wal_size': 1024000,\n#     'compression': 'zstd',\n# }\n</code></pre>"},{"location":"zh/guide/persisting/#_16","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":""},{"location":"zh/guide/persisting/#_17","title":"\u751f\u4ea7\u200b\u914d\u7f6e","text":"<pre><code>import pulsing as pul\n\n# \u200b\u63a8\u8350\u200b\u7684\u200b\u751f\u4ea7\u200b\u8bbe\u7f6e\u200b\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"production\",\n    backend=\"persisting\",\n    storage_path=\"/data/queues\",\n    batch_size=1000,\n    backend_options={\n        \"enable_wal\": True,\n        \"compression\": \"zstd\",\n        \"enable_metrics\": True,\n        \"wal_sync_interval\": 0.1,  # \u200b\u4f4e\u200b\u5ef6\u8fdf\u200b\n    },\n)\n</code></pre>"},{"location":"zh/guide/persisting/#_18","title":"\u9ad8\u200b\u541e\u5410\u91cf","text":"<pre><code>import pulsing as pul\n\n# \u200b\u7528\u4e8e\u200b\u9ad8\u200b\u541e\u5410\u91cf\u200b\u5de5\u4f5c\u200b\u8d1f\u8f7d\u200b\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"high_throughput\",\n    backend=\"persisting\",\n    batch_size=10000,\n    backend_options={\n        \"enable_wal\": False,  # \u200b\u727a\u7272\u200b\u6301\u4e45\u6027\u200b\u6362\u53d6\u200b\u901f\u5ea6\u200b\n        \"compression\": \"lz4\",  # \u200b\u5feb\u901f\u200b\u538b\u7f29\u200b\n    },\n)\n</code></pre>"},{"location":"zh/guide/persisting/#_19","title":"\u9ad8\u200b\u6301\u4e45\u6027","text":"<pre><code>import pulsing as pul\n\n# \u200b\u7528\u4e8e\u200b\u5173\u952e\u200b\u6570\u636e\u200b\nwriter = await pul.queue.write_queue(\n    system,\n    topic=\"critical_data\",\n    backend=\"persisting\",\n    batch_size=100,\n    backend_options={\n        \"enable_wal\": True,\n        \"wal_sync_interval\": 0.0,  # \u200b\u6bcf\u6b21\u200b\u5199\u5165\u200b\u90fd\u200b\u540c\u6b65\u200b\n        \"compression\": \"zstd\",\n    },\n)\n</code></pre>"},{"location":"zh/guide/persisting/#lance","title":"\u4e0e\u200b Lance \u200b\u540e\u200b\u7aef\u200b\u6bd4\u8f83","text":"\u529f\u80fd\u200b Lance Persisting \u200b\u57fa\u672c\u200b\u6301\u4e45\u200b\u5316\u200b \u2705 \u2705 \u200b\u7248\u672c\u63a7\u5236\u200b \u2705 \u2705 \u200b\u5411\u91cf\u200b\u641c\u7d22\u200b \u2705 \u2705 WAL \u274c \u2705 Schema \u200b\u6f14\u8fdb\u200b \u274c \u2705 \u200b\u538b\u7f29\u200b\u9009\u9879\u200b \u200b\u6709\u9650\u200b \u200b\u5b8c\u6574\u200b Prometheus \u200b\u6307\u6807\u200b \u274c \u2705"},{"location":"zh/guide/persisting/#_20","title":"\u4e0b\u200b\u4e00\u6b65","text":"<ul> <li>\u200b\u81ea\u5b9a\u4e49\u200b\u540e\u200b\u7aef\u200b - \u200b\u5b9e\u73b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u540e\u200b\u7aef\u200b</li> <li>\u200b\u67b6\u6784\u8bbe\u8ba1\u200b - \u200b\u8bbe\u8ba1\u200b\u8be6\u60c5\u200b</li> <li>API \u200b\u53c2\u8003\u200b - \u200b\u8be6\u7ec6\u200b API \u200b\u6587\u6863\u200b</li> </ul>"}]}